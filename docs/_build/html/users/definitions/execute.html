

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Execute &mdash; Teflo 1.9.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_override.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'1.9.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Report" href="report.html" />
    <link rel="prev" title="Orchestrate" href="orchestrate.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Teflo
          

          
          </a>

          
            
            
              <div class="version">
                1.9.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install Teflo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configure Teflo</a></li>
</ul>
<p class="caption"><span class="caption-text">Using Teflo</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">User’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html#detailed-information">Detailed Information</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../scenario_descriptor.html">Scenario Descriptor</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="resource_check.html">Resource Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="credentials.html">Credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="include.html">Including Scenarios</a></li>
<li class="toctree-l3"><a class="reference internal" href="provision.html">Provision</a></li>
<li class="toctree-l3"><a class="reference internal" href="orchestrate.html">Orchestrate</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Execute</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hosts">Hosts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ansible">Ansible</a></li>
<li class="toctree-l4"><a class="reference internal" href="#return-code-for-test-execution">Return Code for Test Execution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-shell-parameter-for-test-execution">Using Shell Parameter for Test Execution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extra-args-for-script-and-shell">Extra_args for script and shell</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-playbook-parameter-for-test-execution">Using Playbook Parameter for Test Execution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-substitution-required-for-test-execution">Data Substitution Required for Test Execution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#artifacts-of-the-test-execution">Artifacts of the Test Execution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#common-examples">Common Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="report.html">Report</a></li>
<li class="toctree-l3"><a class="reference internal" href="notifications.html">Notification</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeout.html">Timeout settings for Teflo Tasks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../data_pass_through.html">Data Pass-through</a></li>
<li class="toctree-l2"><a class="reference internal" href="../output.html">Teflo Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../best_practices.html">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../localhost.html">Using Localhost</a></li>
<li class="toctree-l2"><a class="reference internal" href="../variable_data.html">Using Jinja Variable Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resource_labels.html">Using Resource Labels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faqs.html">FAQS</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Teflo Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developers/index.html">Developer’s Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html">Contacts</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Teflo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">User’s Guide</a> &raquo;</li>
        
          <li><a href="../scenario_descriptor.html">Scenario Descriptor</a> &raquo;</li>
        
      <li>Execute</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/users/definitions/execute.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="execute">
<h1>Execute<a class="headerlink" href="#execute" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Teflo’s execute section declares the test execution of the scenario.  In
most cases there would be three major steps performed during execution:</p>
<ul class="simple">
<li>cloning the tests</li>
<li>executing the tests</li>
<li>gathering the test results, logs, and other important information for the
test execution.</li>
</ul>
<p>The execution is further broken down into 3 different types:</p>
<ul class="simple">
<li>execution using a command</li>
<li>execution using a user defined script</li>
<li>execution using a user defined playbook</li>
</ul>
<p>The following is the basic structure that defines an execution task, using a
command for execution:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">execute</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span>
    <span class="n">description</span><span class="p">:</span>
    <span class="n">executor</span><span class="p">:</span>
    <span class="n">hosts</span><span class="p">:</span>
    <span class="n">ignore_rc</span><span class="p">:</span> <span class="kc">False</span>
    <span class="n">git</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">repo</span><span class="p">:</span>
        <span class="n">version</span><span class="p">:</span>
        <span class="n">dest</span><span class="p">:</span>
    <span class="n">shell</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">command</span><span class="p">:</span> <span class="n">cmd_to_execute_the_tests</span>
        <span class="n">chdir</span><span class="p">:</span>
    <span class="n">artifacts</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">~/</span><span class="n">restraint</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">tests</span>
      <span class="o">-</span> <span class="o">~/</span><span class="n">another_artificate_dir</span>
    <span class="n">ansible_options</span><span class="p">:</span>
</pre></div>
</div>
<p>The following is the basic structure that defines an execution task, using a
user defined script for execution:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">execute</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span>
    <span class="n">description</span><span class="p">:</span>
    <span class="n">executor</span><span class="p">:</span>
    <span class="n">hosts</span><span class="p">:</span>
    <span class="n">ignore_rc</span><span class="p">:</span> <span class="kc">False</span>
    <span class="n">git</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">repo</span><span class="p">:</span>
        <span class="n">version</span><span class="p">:</span>
        <span class="n">dest</span><span class="p">:</span>
    <span class="n">script</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">chdir</span><span class="p">:</span> <span class="o">/</span><span class="n">tmp</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">tests</span><span class="o">.</span><span class="n">sh</span> <span class="n">arg1</span> <span class="n">arg2</span>
    <span class="n">artifacts</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">~/</span><span class="n">restraint</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">tests</span>
      <span class="o">-</span> <span class="o">~/</span><span class="n">another_artificate_dir</span>
    <span class="n">ansible_options</span><span class="p">:</span>
</pre></div>
</div>
<p>The following is the basic structure that defines an exectuion task, using a
user defined playbook for execution:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">execute</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span>
    <span class="n">description</span><span class="p">:</span>
    <span class="n">executor</span><span class="p">:</span>
    <span class="n">hosts</span><span class="p">:</span>
    <span class="n">ignore_rc</span><span class="p">:</span> <span class="kc">False</span>
    <span class="n">git</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">repo</span><span class="p">:</span>
        <span class="n">version</span><span class="p">:</span>
        <span class="n">dest</span><span class="p">:</span>
    <span class="n">playbook</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">tests</span><span class="o">/</span><span class="n">test</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">artifacts</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">~/</span><span class="n">restraint</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">tests</span>
      <span class="o">-</span> <span class="o">~/</span><span class="n">another_artificate_dir</span>
    <span class="n">ansible_options</span><span class="p">:</span>

</pre></div>
</div>
<p>The above code snippet is the minimal structure that is required to create a
execute task within teflo. This task is translated into a teflo execute
object which is part of the teflo compound. You can learn more about this at
the <a class="reference external" href="../../developers/architecture.html">architecture</a> page.</p>
<p>Please see the table below to understand the key/values defined.</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Description</th>
<th class="head">Type</th>
<th class="head">Required</th>
<th class="head">Default</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>name</td>
<td>Name assigned to the execution task</td>
<td>String</td>
<td>Yes</td>
<td>n/a</td>
</tr>
<tr class="row-odd"><td>description</td>
<td>Description of the execution task</td>
<td>String</td>
<td>No</td>
<td>n/a</td>
</tr>
<tr class="row-even"><td>executor</td>
<td>Name of the executor to be used</td>
<td>String</td>
<td>No</td>
<td>runner</td>
</tr>
<tr class="row-odd"><td>hosts</td>
<td>the machine(s) that execute will run on</td>
<td>String</td>
<td>Yes</td>
<td>n/a</td>
</tr>
<tr class="row-even"><td>ignore_rc</td>
<td>ignore the return code of the execution</td>
<td>Boolean</td>
<td>No</td>
<td>False</td>
</tr>
<tr class="row-odd"><td>valid_rc</td>
<td>valid return codes of the execution (success)</td>
<td>list of integers</td>
<td>No</td>
<td>n/a</td>
</tr>
<tr class="row-even"><td>git</td>
<td>git information for the tests in execution</td>
<td>list of dictionaries</td>
<td>No</td>
<td>n/a</td>
</tr>
<tr class="row-odd"><td>shell</td>
<td>list of shell commands to execute the tests.</td>
<td>list of dictionaries</td>
<td>(Not required; however, one of the following must be defined:
shell, script or playbook)</td>
<td>False</td>
</tr>
<tr class="row-even"><td>script</td>
<td>list of scripts to execute to run the tests.</td>
<td>list of dictionaries</td>
<td>(Not required; however, one of the following must be defined:
shell, script or playbook)</td>
<td>False</td>
</tr>
<tr class="row-odd"><td>playbook</td>
<td>list of playbooks that execute the tests.</td>
<td>list of dictionaries</td>
<td>(Not required; however, one of the following must be defined:
shell, script or playbook)</td>
<td>False</td>
</tr>
<tr class="row-even"><td>artifacts</td>
<td>list of all the data to collect after execution.
If a directory is listed, all data in that folder
will be gathered.  A single file can also be listed.</td>
<td>list</td>
<td>No</td>
<td>n/a</td>
</tr>
<tr class="row-odd"><td>artifact_locations</td>
<td>A list of data collected during artifacts or a list of additional log files to be
considered by Teflo after execution.
It is a list of relative path for the directories or files to be considered
under the teflo’s <strong>.results</strong> folder.</td>
<td>dict</td>
<td>No</td>
<td>n/a</td>
</tr>
<tr class="row-even"><td>ansible_options</td>
<td>git information for the tests in execution</td>
<td>dictionary of ansible options</td>
<td>No</td>
<td>n/a</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="hosts">
<h2>Hosts<a class="headerlink" href="#hosts" title="Permalink to this headline">¶</a></h2>
<p>Teflo provides many ways to define your host.  This has already been
described in the orchestration section, please view information about
defining the hosts <a class="reference external" href="orchestrate.html#hosts">here</a>. For more localhost
usage refer to the <a class="reference external" href="../localhost.html">localhost</a> page.</p>
</div>
<div class="section" id="ansible">
<h2>Ansible<a class="headerlink" href="#ansible" title="Permalink to this headline">¶</a></h2>
<p>The default executor ‘<em>runner</em>’ uses ansible to perform the requested actions.
This means users can set ansible options to be used by the runner executor.
In this case, the options should mostly be used for defining the user that is
performing the execution. Please see the following example for more details:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">ansible_options</span><span class="p">:</span>
      <span class="n">become</span><span class="p">:</span> <span class="kc">True</span>
      <span class="n">become_method</span><span class="p">:</span> <span class="n">sudo</span>
      <span class="n">become_user</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">become_user</span><span class="o">&gt;</span>
      <span class="n">remote_user</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">remote_user</span><span class="o">&gt;</span>
<span class="o">...</span>

</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Teflo uses the ansible copy module to process the results of the requested action. The copy module requires selinux
access. Refer to the <a class="reference external" href="../install.html#install">install guide</a>.</p>
</div>
<div class="section" id="ansible-logs">
<h3>Ansible Logs<a class="headerlink" href="#ansible-logs" title="Permalink to this headline">¶</a></h3>
<p>To get ansible logs, you must set the <strong>log_path</strong> in the ansible.cfg, and it
is recommended to set the <strong>log_filter</strong> in the ansible.cfg as described to
filter out non ansible logs.  If you do not set the log path or don’t provide
an ansible.cfg, you will not get any ansible logs.  The ansible log will be
added to the <strong>ansible_executor</strong> folder under the logs folder of teflo’s output,
please see <a class="reference external" href="../output.html">Teflo Output</a> for more details.</p>
</div>
</div>
<div class="section" id="return-code-for-test-execution">
<h2>Return Code for Test Execution<a class="headerlink" href="#return-code-for-test-execution" title="Permalink to this headline">¶</a></h2>
<p>Teflo will fail out if there is a non-zero return code.  However, for many
unit testing frameworks there is a non-zero return code if there are test failures.
For this case, teflo has two options to handle these situations:</p>
<blockquote>
<div><ol class="arabic simple">
<li>ignore the return code for the test execution</li>
<li>give list of valid return codes that will not flag failure</li>
</ol>
</div></blockquote>
<p>Option 1 to handle non-zero return codes is called <strong>ignore_rc</strong>, this option
can be used at the top level key of execute or can also be used for each
specific call.  The following shows an example, where it is defined in both
areas.  The top level is set to False, which is the default, then it is used
only for the 2nd pytest execution call, where there are failures:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">execute</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">pytest</span> <span class="n">execution</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;execute pytests on the clients&quot;</span>
    <span class="n">hosts</span><span class="p">:</span> <span class="n">clients</span>
    <span class="n">executor</span><span class="p">:</span> <span class="n">runner</span>
    <span class="n">ignore_rc</span><span class="p">:</span> <span class="kc">False</span>
    <span class="n">git</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">repo</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gitlab</span><span class="o">.</span><span class="n">cee</span><span class="o">.</span><span class="n">redhat</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">PIT</span><span class="o">/</span><span class="n">teflo</span><span class="o">/</span><span class="n">pytest</span><span class="o">-</span><span class="n">example</span><span class="o">.</span><span class="n">git</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">master</span>
        <span class="n">dest</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">pytest</span>
    <span class="n">shell</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">chdir</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">pytest</span><span class="o">/</span><span class="n">tests</span>
        <span class="n">command</span><span class="p">:</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pytest</span> <span class="n">test_sample</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">junit</span><span class="o">-</span><span class="n">xml</span> <span class="n">test</span><span class="o">-</span><span class="n">report</span><span class="o">/</span><span class="n">suite1_results</span><span class="o">.</span><span class="n">xml</span>
      <span class="o">-</span> <span class="n">chdir</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">pytest</span><span class="o">/</span><span class="n">tests</span>
        <span class="n">command</span><span class="p">:</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pytest</span> <span class="n">sample_unittest</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">junit</span><span class="o">-</span><span class="n">xml</span> <span class="n">test</span><span class="o">-</span><span class="n">report</span><span class="o">/</span><span class="n">suite2_results</span><span class="o">.</span><span class="n">xml</span>
        <span class="n">ignore_rc</span><span class="p">:</span> <span class="kc">True</span>
    <span class="n">artifacts</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">pytest</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">report</span><span class="o">/</span><span class="n">suite1_results</span><span class="o">.</span><span class="n">xml</span>
      <span class="o">-</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">pytest</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">report</span><span class="o">/</span><span class="n">suite2_results</span><span class="o">.</span><span class="n">xml</span>
<span class="o">...</span>

</pre></div>
</div>
<p>Options 2 to handle non-zero return codes is called <strong>valid_rc</strong>, this option
can also be used at the top level key of execute or can be used for each
specific call. If <strong>ignore_rc</strong> is set it takes precedence. The following shows
an example, where it is defined in both areas. The top level is set to one value
and the call overides it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">execute</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">pytest</span> <span class="n">execution</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;execute pytests on the clients&quot;</span>
    <span class="n">hosts</span><span class="p">:</span> <span class="n">clients</span>
    <span class="n">executor</span><span class="p">:</span> <span class="n">runner</span>
    <span class="n">valid_rc</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
    <span class="n">git</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">repo</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gitlab</span><span class="o">.</span><span class="n">cee</span><span class="o">.</span><span class="n">redhat</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">PIT</span><span class="o">/</span><span class="n">teflo</span><span class="o">/</span><span class="n">pytest</span><span class="o">-</span><span class="n">example</span><span class="o">.</span><span class="n">git</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">master</span>
        <span class="n">dest</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">pytest</span>
    <span class="n">shell</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">chdir</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">pytest</span><span class="o">/</span><span class="n">tests</span>
        <span class="n">command</span><span class="p">:</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pytest</span> <span class="n">test_sample</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">junit</span><span class="o">-</span><span class="n">xml</span> <span class="n">test</span><span class="o">-</span><span class="n">report</span><span class="o">/</span><span class="n">suite1_results</span><span class="o">.</span><span class="n">xml</span>
      <span class="o">-</span> <span class="n">chdir</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">pytest</span><span class="o">/</span><span class="n">tests</span>
        <span class="n">command</span><span class="p">:</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pytest</span> <span class="n">sample_unittest</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">junit</span><span class="o">-</span><span class="n">xml</span> <span class="n">test</span><span class="o">-</span><span class="n">report</span><span class="o">/</span><span class="n">suite2_results</span><span class="o">.</span><span class="n">xml</span>
        <span class="n">valid_rc</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
    <span class="n">artifacts</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">pytest</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">report</span><span class="o">/</span><span class="n">suite1_results</span><span class="o">.</span><span class="n">xml</span>
      <span class="o">-</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">pytest</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">report</span><span class="o">/</span><span class="n">suite2_results</span><span class="o">.</span><span class="n">xml</span>
<span class="o">...</span>

</pre></div>
</div>
</div>
<div class="section" id="using-shell-parameter-for-test-execution">
<span id="using-shell"></span><h2>Using Shell Parameter for Test Execution<a class="headerlink" href="#using-shell-parameter-for-test-execution" title="Permalink to this headline">¶</a></h2>
<p>When building your shell commands it is important to take into consideration
that there are multiple layers the command is being passed through before
being executed. The two main things to pay attention to are
YAML syntax/escaping and Shell escaping.</p>
<p>When writing the command in the scenario descriptor file it needs to be written in
a way that both Teflo and Ansible can parse the YAML properly. From a Teflo perspective
it is when the the scenario descriptor is first loaded. From an Ansible perspective
its when we pass it the playbook we create, cbn_execute_shell.yml, through to the
ansible-playbook CLI.</p>
<p>Then there could be further escapes required to preserve the test command so it can be
interpreted by the shell properly. From a Teflo perspective that is when we
pass the test command to the ansible-playbook CLI on the local shell using the
-e “xcmd=’&lt;test_command&gt;’” parameter. From the Ansible perspective its when
the shell module executes the actual test command using the shell on the designated system.</p>
<p>Let’s go into a couple examples</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">shell</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">glusto --pytest=&#39;-v tests/test_sample.py --junitxml=/tmp/SampleTest.xml&#39;</span>
             <span class="l l-Scalar l-Scalar-Plain">--log /tmp/glusto_sample.log</span>
</pre></div>
</div>
<p>On the surface the above command will pass YAML syntax parsing but will fail when actually
executing the command on the shell. That is because the command is not preserved properly on
the shell when it comes to the <em>–pytest</em> optioned being passed in. In order to get
this to work you could escape this in one of two ways so that the <em>–pytest</em> optioned is
preserved.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">shell</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">glusto --pytest=\\\&quot;-v tests/test_sample.py --junitxml=/tmp/SampleTest.xml\\\&quot;</span>
             <span class="l l-Scalar l-Scalar-Plain">--log /tmp/glusto_sample.log</span>


<span class="nt">shell</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">glusto \\\&quot;--pytest=-v tests/test_sample.py --junitxml=/tmp/SampleTest.xml\\\&quot;</span>
             <span class="l l-Scalar l-Scalar-Plain">--log /tmp/glusto_sample.log</span>
</pre></div>
</div>
<p>Here is a more complex example</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">shell</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">if [ `echo \$PRE_GA | tr [:upper:] [:lower:]` == &#39;true&#39; ];</span>
               <span class="l l-Scalar l-Scalar-Plain">then sed -i &#39;s/pre_ga:.*/pre_ga</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true/&#39; ansible/test_playbook.yml; fi</span>
</pre></div>
</div>
<p>By default this will fail to be parsed by YAML as improper syntax. The rule of thumb is
if your unquoted YAML string has any of the following special characters :-{}[]!#|&gt;&amp;%&#64;
the best practice is to quote the string. You have the option to either use single quote
or double quotes. There are pros and cons to which quoting method to use. There are online
resources that go further into this topic.</p>
<p>Once the string is quoted, you now need to make sure the command is preserved properly
on the shell. Below are a couple of examples of how you could achieve this using either
a single quoted or double quoted YAML string</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">shell</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="s">&#39;if</span><span class="nv"> </span><span class="s">[</span><span class="nv"> </span><span class="s">\`echo</span><span class="nv"> </span><span class="s">\$PRE_GA</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">tr</span><span class="nv"> </span><span class="s">[:upper:]</span><span class="nv"> </span><span class="s">[:lower:]\`</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="se">&#39;&#39;</span><span class="s">true</span><span class="se">&#39;&#39;</span><span class="nv"> </span><span class="s">];</span>
               <span class="s">then</span><span class="nv"> </span><span class="s">sed</span><span class="nv"> </span><span class="s">-i</span><span class="nv"> </span><span class="s">\&quot;s/pre_ga:.*/pre_ga:</span><span class="nv"> </span><span class="s">true/\&quot;</span><span class="nv"> </span><span class="s">ansible/test_playbook.yml;</span><span class="nv"> </span><span class="s">fi&#39;</span>


<span class="nt">shell</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="s">&quot;if</span><span class="nv"> </span><span class="s">[</span><span class="nv"> </span><span class="s">\\`echo</span><span class="nv"> </span><span class="s">\\$PRE_GA</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">tr</span><span class="nv"> </span><span class="s">[:upper:]</span><span class="nv"> </span><span class="s">[:lower:]\\`</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">\\&#39;true\\&#39;</span><span class="nv"> </span><span class="s">];</span>
               <span class="s">then</span><span class="nv"> </span><span class="s">sed</span><span class="nv"> </span><span class="s">\\&#39;s/pre_ga:.*/pre_ga:</span><span class="nv"> </span><span class="s">true/\\&#39;</span><span class="nv"> </span><span class="s">ansible/test_playbook.yml;</span><span class="nv"> </span><span class="s">fi&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is NOT recommended to output verbose logging to standard output for long running tests as there could be
issues with teflo parsing the output</p>
</div>
</div>
<div class="section" id="extra-args-for-script-and-shell">
<h2>Extra_args for script and shell<a class="headerlink" href="#extra-args-for-script-and-shell" title="Permalink to this headline">¶</a></h2>
<p>Teflo supports the following parameters used by ansible script and shell modules</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameters</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>chdir</td>
</tr>
<tr class="row-odd"><td>creates</td>
</tr>
<tr class="row-even"><td>decrypt</td>
</tr>
<tr class="row-odd"><td>executable</td>
</tr>
<tr class="row-even"><td>removes</td>
</tr>
<tr class="row-odd"><td>warn</td>
</tr>
<tr class="row-even"><td>stdin</td>
</tr>
<tr class="row-odd"><td>stdin_add_newline</td>
</tr>
</tbody>
</table>
<p>Please look here for more info</p>
<p><a class="reference external" href="https://docs.ansible.com/ansible/latest/modules/script_module.html">Ansible Script Module</a>
<a class="reference external" href="https://docs.ansible.com/ansible/latest/modules/shell_module.html">Ansible Shell Module</a></p>
</div>
<div class="section" id="using-playbook-parameter-for-test-execution">
<h2>Using Playbook Parameter for Test Execution<a class="headerlink" href="#using-playbook-parameter-for-test-execution" title="Permalink to this headline">¶</a></h2>
<p>Using the playbook parameter to execute tests works like how playbooks
are executed in the Orchestration phase. The only thing not supported is the
ability to download roles using the <em>ansible_galaxy_option</em>. The following
is an example of how run test playbooks.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">execute</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">playbook</span> <span class="n">execution</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;execute playbook tests against the clients&quot;</span>
    <span class="n">hosts</span><span class="p">:</span> <span class="n">clients</span>
    <span class="n">executor</span><span class="p">:</span> <span class="n">runner</span>
    <span class="n">playbook</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">ansible</span><span class="o">/</span><span class="n">test_gather_machine_facts</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">ansible_options</span><span class="p">:</span>
      <span class="n">extra_vars</span><span class="p">:</span>
        <span class="n">workspace</span><span class="p">:</span> <span class="o">.</span>
      <span class="n">skip_tags</span><span class="p">:</span>
       <span class="o">-</span> <span class="n">cleanup</span>
    <span class="n">artifacts</span><span class="p">:</span>
    <span class="o">-</span> <span class="o">~/</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">client</span><span class="o">.</span><span class="n">facts</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Unlike the shell or script parameter the test playbook executes locally
from where teflo is running. Which means the test playbook must be in
the workspace.</p>
</div>
</div>
<div class="section" id="data-substitution-required-for-test-execution">
<h2>Data Substitution Required for Test Execution<a class="headerlink" href="#data-substitution-required-for-test-execution" title="Permalink to this headline">¶</a></h2>
<p>In some cases, you may need to substitute data for the execution.  Teflo
allows you to substitute the information from the dynamically created hosts.</p>
<p>Let’s first take a look at some example data of key/values a user may use
for provisioning a host:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">provision</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">test_client_a</span>
    <span class="n">provisioner</span><span class="p">:</span> <span class="n">openstack</span>
    <span class="n">provider</span><span class="p">:</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">openstack</span>
      <span class="n">credential</span><span class="p">:</span> <span class="n">openstack</span>
      <span class="n">image</span><span class="p">:</span> <span class="n">rhel</span><span class="o">-</span><span class="mf">7.6</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">released</span>
      <span class="n">flavor</span><span class="p">:</span> <span class="n">m1</span><span class="o">.</span><span class="n">small</span>
      <span class="n">networks</span><span class="p">:</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">defined_os_network</span><span class="o">&gt;</span><span class="p">]</span>
      <span class="n">floating_ip_pool</span><span class="p">:</span> <span class="s2">&quot;&lt;defined_fip&gt;&quot;</span>
      <span class="n">keypair</span><span class="p">:</span> <span class="n">pit</span><span class="o">-</span><span class="n">jenkins</span>
    <span class="n">role</span><span class="p">:</span> <span class="n">clients</span>
    <span class="n">ansible_params</span><span class="p">:</span>
      <span class="n">ansible_user</span><span class="p">:</span> <span class="n">cloud_user</span>
      <span class="n">ansible_ssh_private_key_file</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">defined_key_file</span><span class="o">&gt;</span>
<span class="o">...</span>

</pre></div>
</div>
<p>After the machines are provsioned, we have more information in the host object,
and this can be seen by the results.yml file after a provision is successful.
Some basic information that is added is the machine’s actual name and ip
address.  The following is what the data looks like after provisioning:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">provision</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">test_client_a</span>
    <span class="n">provisioner</span><span class="p">:</span> <span class="n">openstack</span>
    <span class="n">provider</span><span class="p">:</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">openstack</span>
      <span class="n">credential</span><span class="p">:</span> <span class="n">openstack</span>
      <span class="n">image</span><span class="p">:</span> <span class="n">rhel</span><span class="o">-</span><span class="mf">7.6</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">released</span>
      <span class="n">flavor</span><span class="p">:</span> <span class="n">m1</span><span class="o">.</span><span class="n">small</span>
      <span class="n">networks</span><span class="p">:</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">defined_os_network</span><span class="o">&gt;</span><span class="p">]</span>
      <span class="n">floating_ip_pool</span><span class="p">:</span> <span class="s2">&quot;&lt;defined_fip&gt;&quot;</span>
      <span class="n">keypair</span><span class="p">:</span> <span class="n">pit</span><span class="o">-</span><span class="n">jenkins</span>
      <span class="n">admin_pass</span><span class="p">:</span> <span class="n">null</span>
      <span class="n">description</span><span class="p">:</span> <span class="n">null</span>
      <span class="n">files</span><span class="p">:</span> <span class="n">null</span>
      <span class="n">node_id</span><span class="p">:</span> <span class="mf">82340e64</span><span class="o">-</span><span class="n">c7b7</span><span class="o">-</span><span class="mi">4</span><span class="n">a20</span><span class="o">-</span><span class="n">a9e3</span><span class="o">-</span><span class="mi">6511</span><span class="n">dbc79ded</span>
      <span class="n">security_groups</span><span class="p">:</span> <span class="n">null</span>
    <span class="n">ip_address</span><span class="p">:</span> <span class="mf">10.8</span><span class="o">.</span><span class="mf">250.239</span>
    <span class="n">role</span><span class="p">:</span> <span class="n">clients</span>
    <span class="n">ansible_params</span><span class="p">:</span>
      <span class="n">ansible_user</span><span class="p">:</span> <span class="n">cloud_user</span>
      <span class="n">ansible_ssh_private_key_file</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">defined_key_file</span><span class="o">&gt;</span>
    <span class="n">data_folder</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">teflo</span><span class="o">/</span><span class="n">ljcgm7yl5d</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="p">{}</span>
<span class="o">...</span>

</pre></div>
</div>
<p>Looking at the data presented above, there is a lot of information about the
host, that may be useful for test execution.  You can also see the key
<strong>metadata</strong>, this key can be used to set any data the user wishes to when
running teflo.</p>
<p>The following is an example, where the user plans to use the ip address in an
execution command.  From the data above, you can see the user is accessing the
data from <strong>test_client_a</strong> -&gt; <strong>ip_address</strong>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">execute</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">restraint</span> <span class="n">test</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;execute tests by restraint framework&quot;</span>
    <span class="n">executor</span><span class="p">:</span> <span class="n">runner</span>
    <span class="n">hosts</span><span class="p">:</span> <span class="n">driver</span>
    <span class="n">git</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">repo</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gitlab</span><span class="o">.</span><span class="n">cee</span><span class="o">.</span><span class="n">redhat</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">PIT</span><span class="o">/</span><span class="n">teflo</span><span class="o">/</span><span class="n">restraint</span><span class="o">-</span><span class="n">example</span><span class="o">.</span><span class="n">git</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">master</span>
        <span class="n">dest</span><span class="p">:</span> <span class="o">~/</span><span class="n">restraint</span><span class="o">-</span><span class="n">example</span>
    <span class="n">shell</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">command</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">restraint</span> <span class="o">-</span><span class="n">vvv</span> <span class="o">--</span><span class="n">host</span> <span class="mi">1</span><span class="o">=</span><span class="n">root</span><span class="o">@</span><span class="p">{</span> <span class="n">test_client_a</span><span class="o">.</span><span class="n">ip_address</span> <span class="p">}:</span><span class="mi">8081</span> <span class="o">--</span><span class="n">job</span> <span class="o">./</span><span class="n">test_sample</span><span class="o">.</span><span class="n">xml</span>
        <span class="n">chdir</span><span class="p">:</span> <span class="o">~/</span><span class="n">restraint</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">tests</span>
      <span class="o">-</span> <span class="n">command</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">restraint</span> <span class="o">-</span><span class="n">vvv</span> <span class="o">--</span><span class="n">host</span> <span class="mi">1</span><span class="o">=</span><span class="n">root</span><span class="o">@</span><span class="p">{</span> <span class="n">test_client_b</span><span class="o">.</span><span class="n">ip_address</span> <span class="p">}:</span><span class="mi">8081</span> <span class="o">--</span><span class="n">job</span> <span class="o">./</span><span class="n">test_sample</span><span class="o">.</span><span class="n">xml</span>
        <span class="n">chdir</span><span class="p">:</span> <span class="o">~/</span><span class="n">restraint</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">tests</span>
    <span class="n">artifacts</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">~/</span><span class="n">restraint</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test_</span><span class="o">*</span>
<span class="o">...</span>

</pre></div>
</div>
</div>
<div class="section" id="artifacts-of-the-test-execution">
<h2>Artifacts of the Test Execution<a class="headerlink" href="#artifacts-of-the-test-execution" title="Permalink to this headline">¶</a></h2>
<p>After an execution is complete, it is common to get results of the test
execution, logs related to the execution, and other logs or files generated
by a specific product during the execution.  These will all be gathered by
teflo and placed in an artifacts directory of your data directory.</p>
<p>For the data gathering, if you specify a folder, teflo will gather all the
data under that folder, if you specify a file, it will gather that single
file.</p>
<p>The following is a simple example of the data gathering (defining artifacts):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">execute</span><span class="p">:</span>
<span class="o">...</span>
    <span class="n">artifacts</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">pytest</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">report</span><span class="o">/</span><span class="n">suite1_results</span><span class="o">.</span><span class="n">xml</span>
      <span class="o">-</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">pytest</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">report</span><span class="o">/</span><span class="n">suite2_results</span><span class="o">.</span><span class="n">xml</span>
      <span class="o">-</span> <span class="o">~/</span><span class="n">restraint</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span>
<span class="o">...</span>

</pre></div>
</div>
<p>Going through the basics of artifacts, the user can archive individual files,
as shown by the following example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">artifacts</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">pytest</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">report</span><span class="o">/</span><span class="n">suite1_results</span><span class="o">.</span><span class="n">xml</span>
      <span class="o">-</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">pytest</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">report</span><span class="o">/</span><span class="n">suite2_results</span><span class="o">.</span><span class="n">xml</span>
<span class="o">...</span>

</pre></div>
</div>
<p>The user can also artifact files using wildcards as shown in the following
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">artifacts</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">pytest</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">report</span><span class="o">/</span><span class="n">suite</span><span class="o">*.</span><span class="n">xml</span>
<span class="o">...</span>

</pre></div>
</div>
<p>The user can also archive a directory using either of the following two
examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">artifacts</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">~/</span><span class="n">restraint</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">tests</span>
<span class="o">...</span>

</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">artifacts</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">~/</span><span class="n">restraint</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span>
<span class="o">...</span>

</pre></div>
</div>
<p>Finally, the user can archive a directory using a wildcard using either
of the following two examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">artifacts</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">~/</span><span class="n">restraint</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">test</span><span class="o">*</span>
<span class="o">...</span>

</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">artifacts</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">~/</span><span class="n">restraint</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">test</span><span class="o">*/</span>
<span class="o">...</span>

</pre></div>
</div>
<p>Teflo by default will <strong>NOT</strong> exit if the collection of artifact task fails. In order to exit the run on an error during
collection of artifacts user can set the <strong>exit_on_error</strong> field for executor in the teflo.cfg as below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>executor:runner<span class="o">]</span>
<span class="nv">exit_on_error</span><span class="o">=</span>True
</pre></div>
</div>
<div class="section" id="artifact-locations">
<span id="finding-locations"></span><h3>Artifact Locations<a class="headerlink" href="#artifact-locations" title="Permalink to this headline">¶</a></h3>
<p>The <strong>artifact_locations</strong> key is used to keep track of the artifacts that were collected using artifacts key during
execute stage. It’s a list which consists of the relative path of the artifacts to be considered which are placed under
the teflo’s <strong>.results</strong> folder.
With release 1.4.0, the artifact_locations key is being made available to users to define locations for artifacts that
may not have been collected as part of artifacts but they want to be tracked for later use in Report.
The only caveat is the artifacts defined under artifact_locations must be placed in the
teflo_data_folder/.results directory. Refer to the <a class="reference internal" href="report.html#finding-artifacts"><span class="std std-ref">Finding the right artifacts</span></a></p>
<p>Teflo also auto creates the artifacts folder under the .results folder. Users can place their artifacts in this folder
as well</p>
<p>In the below example, the payload_dir is the name of the directory  which is present under the .results folder</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">execute</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span>
    <span class="n">description</span><span class="p">:</span>
    <span class="n">executor</span><span class="p">:</span>
    <span class="n">hosts</span><span class="p">:</span>
    <span class="n">ignore_rc</span><span class="p">:</span> <span class="kc">False</span>
    <span class="n">git</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">repo</span><span class="p">:</span>
        <span class="n">version</span><span class="p">:</span>
        <span class="n">dest</span><span class="p">:</span>
    <span class="n">shell</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">command</span><span class="p">:</span> <span class="n">cmd_to_execute_the_tests</span>
        <span class="n">chdir</span><span class="p">:</span>
    <span class="n">artifacts</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">~/</span><span class="n">restraint</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">tests</span>
      <span class="o">-</span> <span class="o">~/</span><span class="n">another_artificate_dir</span>
    <span class="n">artifact_locations</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">payload_dir</span><span class="o">/</span><span class="n">results</span><span class="o">/</span>
      <span class="o">-</span> <span class="n">payload_dir</span><span class="o">/</span><span class="n">results</span><span class="o">/</span><span class="n">artifacts</span><span class="o">/</span><span class="n">test1</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
<p>In the below example, the payload_dir  and dir1 are placed in the artifacts folder created by teflo.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">execute</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span>
    <span class="n">description</span><span class="p">:</span>
    <span class="n">executor</span><span class="p">:</span>
    <span class="n">hosts</span><span class="p">:</span>
    <span class="n">ignore_rc</span><span class="p">:</span> <span class="kc">False</span>
    <span class="n">git</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">repo</span><span class="p">:</span>
        <span class="n">version</span><span class="p">:</span>
        <span class="n">dest</span><span class="p">:</span>
    <span class="n">shell</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">command</span><span class="p">:</span> <span class="n">cmd_to_execute_the_tests</span>
        <span class="n">chdir</span><span class="p">:</span>
    <span class="n">artifacts</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">~/</span><span class="n">restraint</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">tests</span>
      <span class="o">-</span> <span class="o">~/</span><span class="n">another_artificate_dir</span>
    <span class="n">artifact_locations</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">artifacts</span><span class="o">/</span><span class="n">payload_dir</span><span class="o">/</span>
      <span class="o">-</span> <span class="n">artifacts</span><span class="o">/</span><span class="n">dir1</span><span class="o">/</span><span class="n">abc</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
</div>
<div class="section" id="testrun-results-for-artifacts-collected-during-the-execute-block">
<h3>Testrun Results for Artifacts collected during the Execute block:<a class="headerlink" href="#testrun-results-for-artifacts-collected-during-the-execute-block" title="Permalink to this headline">¶</a></h3>
<p>Teflo generates a testrun results summary for all the <strong>xml files</strong> it collects as a part of artifacts OR
artifact_locations in an execute block. This summary can be seen in the results.xml as weel as is printed out
on the console. The summary shows aggregate summary of all xmls collected and individual summary
of each xml file. The summary contains <strong>number of tests passed, failed, skipped and the total tests.</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">junit</span>
  <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">execute junit test on client</span>
  <span class="nt">executor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">runner</span>
  <span class="nt">hosts</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">laptop</span>
  <span class="nt">shell</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">chdir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/home/client1/junit/tests</span>
    <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">javac Sample.java; javac UnitTestRunner.java; javac CustomExecutionListener.java; javac SampleTest.java; java UnitTestRunner SampleTest</span>
  <span class="nt">git</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">repo</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://gitlab.cee.redhat.com/ccit/teflo/junit-example.git</span>
    <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">master</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/home/client1/junit</span>
  <span class="nt">artifacts</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/home/client1/junit/tests/*.log</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/home/client1/junit/tests/*.xml</span>
  <span class="nt">artifact_locations</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dir1/junit_example.xml</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">artifacts/client1/junit_example.xml</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">artifacts/client1/ocp_edge_deploment_integration_results.xml</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">artifacts/client1/SampleTest.xml</span>
  <span class="nt">testrun_results</span><span class="p">:</span>
    <span class="nt">aggregate_testrun_results</span><span class="p">:</span>
      <span class="nt">total_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">22</span>
      <span class="nt">failed_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">9</span>
      <span class="nt">skipped_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
      <span class="nt">passed_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">13</span>
    <span class="nt">individual_results</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">junit_example.xml</span><span class="p">:</span>
        <span class="nt">total_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">6</span>
        <span class="nt">failed_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
        <span class="nt">skipped_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
        <span class="nt">passed_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
    <span class="p p-Indicator">-</span> <span class="nt">junit_example.xml</span><span class="p">:</span>
        <span class="nt">total_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">6</span>
        <span class="nt">failed_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
        <span class="nt">skipped_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
        <span class="nt">passed_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
    <span class="p p-Indicator">-</span> <span class="nt">ocp_edge_deploment_integration_results.xml</span><span class="p">:</span>
        <span class="nt">total_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8</span>
        <span class="nt">failed_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
        <span class="nt">skipped_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
        <span class="nt">passed_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
    <span class="p p-Indicator">-</span> <span class="nt">SampleTest.xml</span><span class="p">:</span>
        <span class="nt">total_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
        <span class="nt">failed_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
        <span class="nt">skipped_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
        <span class="nt">passed_tests</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
</pre></div>
</div>
<p>This is the default behavior of Teflo. If a user does not want this summary generated, user can change the
following setting to False in the teflo.cfg</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>executor:runner<span class="o">]</span>
<span class="nv">testrun_results</span><span class="o">=</span>False
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Teflo expects the xmls collected to have the <strong>&lt;testsuites&gt;</strong> tag  OR <strong>&lt;testsuite&gt;</strong> as its root tag,
else it skips those xml files for testrun summary generation</p>
</div>
</div>
</div>
<div class="section" id="common-examples">
<h2>Common Examples<a class="headerlink" href="#common-examples" title="Permalink to this headline">¶</a></h2>
<p>Please review the following for detailed end to end examples for common
execution use cases:</p>
<ul class="simple">
<li><a class="reference external" href="../examples.html#pytest">Pytest Example</a></li>
<li><a class="reference external" href="../examples.html#junit">JUnit Example</a></li>
<li><a class="reference external" href="../examples.html#restraint">Restraint Example</a></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="report.html" class="btn btn-neutral float-right" title="Report" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="orchestrate.html" class="btn btn-neutral float-left" title="Orchestrate" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Red Hat Inc.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>