

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Orchestrate &mdash; Teflo 1.9.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_override.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'1.9.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Execute" href="execute.html" />
    <link rel="prev" title="Provision" href="provision.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Teflo
          

          
          </a>

          
            
            
              <div class="version">
                1.9.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install Teflo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configure Teflo</a></li>
</ul>
<p class="caption"><span class="caption-text">Using Teflo</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">User’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html#detailed-information">Detailed Information</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../scenario_descriptor.html">Scenario Descriptor</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="resource_check.html">Resource Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="credentials.html">Credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="include.html">Including Scenarios</a></li>
<li class="toctree-l3"><a class="reference internal" href="provision.html">Provision</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Orchestrate</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#hosts">Hosts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#re-running-tasks-and-status-code">Re-running Tasks and Status Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ansible">Ansible</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="execute.html">Execute</a></li>
<li class="toctree-l3"><a class="reference internal" href="report.html">Report</a></li>
<li class="toctree-l3"><a class="reference internal" href="notifications.html">Notification</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeout.html">Timeout settings for Teflo Tasks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../data_pass_through.html">Data Pass-through</a></li>
<li class="toctree-l2"><a class="reference internal" href="../output.html">Teflo Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../best_practices.html">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../localhost.html">Using Localhost</a></li>
<li class="toctree-l2"><a class="reference internal" href="../variable_data.html">Using Jinja Variable Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resource_labels.html">Using Resource Labels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faqs.html">FAQS</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Teflo Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developers/index.html">Developer’s Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html">Contacts</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Teflo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">User’s Guide</a> &raquo;</li>
        
          <li><a href="../scenario_descriptor.html">Scenario Descriptor</a> &raquo;</li>
        
      <li>Orchestrate</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/users/definitions/orchestrate.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="orchestrate">
<h1>Orchestrate<a class="headerlink" href="#orchestrate" title="Permalink to this headline">¶</a></h1>
<p>Teflo’s orchestrate section declares the configuration to be be performed in
order to test the systems properly.</p>
<p>First lets go over the basic structure that defines a configuration task.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span>
    <span class="n">description</span><span class="p">:</span>
    <span class="n">orchestrator</span><span class="p">:</span>
    <span class="n">hosts</span><span class="p">:</span>
</pre></div>
</div>
<p>The above code snippet is the minimal structure that is required to create a
orchestrate task within teflo. This task is translated into a teflo action
object which is part of the teflo compound. You can learn more about this at
the <a class="reference external" href="../../developers/architecture.html">architecture</a> page. Please see the table below to
understand the key/values defined.</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Description</th>
<th class="head">Type</th>
<th class="head">Required</th>
<th class="head">Default</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>name</td>
<td>The name of the action you want teflo to execute OR the path of the script/playbook you want to run
as a part of the orchestrate action</td>
<td>String</td>
<td>Yes</td>
<td>n/a</td>
</tr>
<tr class="row-odd"><td>description</td>
<td>A description of what the resource is trying to accomplish</td>
<td>String</td>
<td>No</td>
<td>n/a</td>
</tr>
<tr class="row-even"><td>orchestrator</td>
<td>The orchestrator to use to execute the action (name) you defined
above</td>
<td>String</td>
<td>No (best practice to define this!)</td>
<td>ansible</td>
</tr>
<tr class="row-odd"><td>hosts</td>
<td>The list of hosts where teflo will execute the action against</td>
<td>List</td>
<td>Yes</td>
<td>n/a</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The name field being used as script/playbook path will be deprecated in the coming releases
Please refer <a class="reference internal" href="#ans"><span class="std std-ref">here</span></a> to get an idea on how to define scripts and playbooks</p>
</div>
<div class="section" id="hosts">
<h2>Hosts<a class="headerlink" href="#hosts" title="Permalink to this headline">¶</a></h2>
<p>You can associate hosts to a given orchestrate task a couple of different ways.
First is to define your hosts in a comma separated string.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">rhsm_register</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">hosts</span><span class="p">:</span> <span class="n">host01</span><span class="p">,</span> <span class="n">host02</span>
</pre></div>
</div>
<p>You can also define your hosts as a list.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">rhsm_register</span>
    <span class="n">hosts</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">host01</span>
      <span class="o">-</span> <span class="n">host02</span>
</pre></div>
</div>
<p>It can become tedious if an orchestrate task needs to be performed on multiple
or all hosts within the scenario and you have many hosts declared. Teflo
provides you with the ability to run against a group of hosts or all hosts.
To run against multiple hosts use the name defined in the <strong>role</strong> key for
your hosts or use <strong>all</strong> to run against all hosts.  This eliminates the need
to define every host per multiple tasks. It can be either in string or list
format.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      <span class="n">hosts</span><span class="p">:</span> <span class="nb">all</span>
      <span class="n">ansible_galaxy_options</span><span class="p">:</span>
        <span class="n">role_file</span><span class="p">:</span> <span class="n">roles</span><span class="o">.</span><span class="n">yml</span>

</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">rhsm_register</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">hosts</span><span class="p">:</span> <span class="nb">all</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">rhsm_register</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">hosts</span><span class="p">:</span>
      <span class="o">-</span> <span class="nb">all</span>
</pre></div>
</div>
</div>
<div class="section" id="re-running-tasks-and-status-code">
<h2>Re-running Tasks and Status Code<a class="headerlink" href="#re-running-tasks-and-status-code" title="Permalink to this headline">¶</a></h2>
<p>You may notice in your results.yml that each orchestrate block has a new parameter</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">status</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
</pre></div>
</div>
<p>When teflo runs any of the defined orchestration tasks successfully a status code of 0
will be set. If an orchestration task fails, teflo will set the status to 1. The next time
you re-run the Orchestration task teflo will check for any orchestration tasks with a failed
status and start the orchestration process from there.</p>
<p>This is useful when you have a long configuration process and you don’t want to start over
all the way from the beginning. If at some point you would rather have the orchestration process
start from the beginning, you can modify the status code back 0.</p>
<hr class="docutils" />
<p>Since teflos development model is plug and play. This means different
orchestrator’s could be used to execute configuration tasks declared. For the
remainder of this page, please go to your preferred orchestrator below. To
learn more on how you can setup your orchestrate task structures.</p>
</div>
<div class="section" id="ansible">
<span id="ans"></span><h2>Ansible<a class="headerlink" href="#ansible" title="Permalink to this headline">¶</a></h2>
<p>Ansible is teflos default orchestrator. As we mentioned above each task has
a given <strong>name</strong> (action). This name can be the ansible playbook name (including the
file extension) or a script name (including the file extension), OR just the orchestrate
task name. Teflo has the ability to find the playbook or script.</p>
<p>Starting version 1.5.0 Teflo supports running shell commands as well. Teflo will use new keywords
to detect to ansible playbook, script or shell command <strong>ansible_playbook, ansible_script, ansible_shell</strong>
respectively. (keeping backward compatibility for using name field to provide script and playbook)</p>
<p>Please refer <a class="reference internal" href="#ans-keys"><span class="std std-ref">here</span></a> to get an idea on how to use the keys</p>
<p>In addition to the required orchestrate base keys, there are more you can define based
on your selected orchestrator.Lets dive into them..</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Description</th>
<th class="head">Type</th>
<th class="head">Required</th>
<th class="head">Default</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ansible_options</td>
<td>Additional options to provide to the ansible orchestrator regarding
the task (playbook) to be executed</td>
<td>Dictionary</td>
<td>No</td>
<td>n/a</td>
</tr>
<tr class="row-odd"><td>ansible_galaxy_options</td>
<td>Additional options to provide to the ansible orchestrator regarding
ansible roles and collections</td>
<td>Dictionary</td>
<td>No</td>
<td>n/a</td>
</tr>
<tr class="row-even"><td>ansible_script</td>
<td>This key can be a boolean or a dictionary
Boolean to define if you are executing a user defined script
(required to be set to True, if using a user defined script)
OR name of the script to be run</td>
<td>Boolean or dictionary</td>
<td>(Not required; however, one of the following must be defined:
ansible_shell/script/playbook)</td>
<td>False</td>
</tr>
<tr class="row-odd"><td>ansible_playbook</td>
<td>playbook to be run.</td>
<td>dictionary</td>
<td>(Not required; however, one of the following must be defined:
ansible_shell/script/playbook)</td>
<td>False</td>
</tr>
<tr class="row-even"><td>ansible_shell</td>
<td>shell commands to be run.</td>
<td>list of dictionary</td>
<td>(Not required; however, one of the following must be defined:
ansible_shell/script/playbook)</td>
<td>False</td>
</tr>
</tbody>
</table>
<p>The table above describes additional key:values you can set within your
orchestrate task. Each of those keys can accept additional key:values.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The ansible_script field as Boolean will be deprecated in the coming releases.</p>
</div>
<div class="section" id="teflo-ansible-configuration">
<h3>Teflo Ansible Configuration<a class="headerlink" href="#teflo-ansible-configuration" title="Permalink to this headline">¶</a></h3>
<p>In the teflo configuration file, you can set some options related to ansible.
These values should be set in the <strong>[orchestrator:ansible]</strong> section of the
teflo.cfg file.  The following are the settings.</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Description</th>
<th class="head">Default</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>log_remove</td>
<td>configuration option to delete the ansible log file after
configuration is complete.  Either way the ansible log
will be moved to the user’s output directory.</td>
<td>By default this is set to true to delete it.</td>
</tr>
<tr class="row-odd"><td>verbosity</td>
<td>configuration option to set the verbosity of ansible.</td>
<td>Teflo sets the ansible verbosity to the value provided
by this option. If this is not set then, teflo will
set the verbosity based on teflo’s logging level.
If logging level is ‘info’ (default) ansible verbosity is
set to <strong>None</strong> else if logging level is ‘debug’ then ansible
verbosity is ‘vvvv’.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If incorrect value for verbosity is set in teflo.cfg, Teflo changes the verbosity based on
teflo’s logging level</p>
</div>
</div>
<div class="section" id="ansible-configuration">
<h3>Ansible Configuration<a class="headerlink" href="#ansible-configuration" title="Permalink to this headline">¶</a></h3>
<p>It is highly recommended that every scenario that uses Ansible provide their
own ansible.cfg file. This can be used for specific connection requirements,
logging, and other settings for the scenario.  The following is an example
of a configuration file that can be used as a base.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">defaults</span><span class="p">]</span>
<span class="c1"># disable strict SSH key host checking</span>
<span class="n">host_key_checking</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># filter out logs that are not ansible related</span>
<span class="n">log_filter</span> <span class="o">=</span> <span class="n">paramiko</span><span class="p">,</span><span class="n">pykwalify</span><span class="p">,</span><span class="n">teflo</span><span class="p">,</span><span class="n">blaster</span><span class="p">,</span><span class="n">urllib3</span>

<span class="c1"># set the path to set ansible logs</span>
<span class="n">log_path</span> <span class="o">=</span> <span class="o">./</span><span class="n">ansible</span><span class="o">.</span><span class="n">log</span>

<span class="c1"># set specific privelege escalation if necessary for the scenario</span>
<span class="p">[</span><span class="n">privilege_escalation</span><span class="p">]</span>
<span class="n">become</span><span class="o">=</span><span class="kc">True</span>
<span class="n">become_method</span><span class="o">=</span><span class="n">sudo</span>
<span class="n">become_user</span><span class="o">=</span><span class="n">test</span>
</pre></div>
</div>
<p>To see all of the settings that can be set see <a class="reference external" href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#ansible-configuration-settings">Ansible Configuation Settings</a>.</p>
</div>
<div class="section" id="ansible-logs">
<h3>Ansible Logs<a class="headerlink" href="#ansible-logs" title="Permalink to this headline">¶</a></h3>
<p>To get ansible logs, you must set the <strong>log_path</strong> in the ansible.cfg, and it
is recommended to set the <strong>log_filter</strong> in the ansible.cfg as described to
filter out non ansible logs.  If you do not set the log path or don’t provide
an ansible.cfg, you will not get any ansible logs.  The ansible log will be
added to the <strong>ansible_orchestrate</strong> folder under the logs folder of teflo’s output,
please see <a class="reference external" href="../output.html">Teflo Output</a> for more details.</p>
</div>
<div class="section" id="using-ansible-script">
<span id="ans-keys"></span><h3>Using ansible_script<a class="headerlink" href="#using-ansible-script" title="Permalink to this headline">¶</a></h3>
<p>Orchestrate task uses ansible script module to run the user provided scripts.
The script name can be given under the name field of the orchestrator task or
within the <em>name</em> key of the ansible_script list of dictionary.</p>
<p>The script parameters can be provided along with name of the script by separating
it using space.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The script parameters can also be passed using ansible_options key. But this will be deprecated in
the future releases
<a class="reference internal" href="#example-15"><span class="std std-ref">Example 15</span></a></p>
</div>
<p>Extra_args for the script can be provided as a part of the ansible_script list
of dictionary or under ansible_options. Please see
<a class="reference internal" href="#extra-args"><span class="std std-ref">Extra_args</span></a>
<a class="reference internal" href="#example-13"><span class="std std-ref">Example 13</span></a>
<a class="reference internal" href="#example-14"><span class="std std-ref">Example 14</span></a></p>
</div>
<div class="section" id="using-ansible-shell">
<h3>Using ansible_shell<a class="headerlink" href="#using-ansible-shell" title="Permalink to this headline">¶</a></h3>
<p>Orchestrate task uses ansible shell module to run the user provided shell commands.
ansible_shell takes in a list of dictionaries for the different commands to be run.
The shell command can be provided under the <em>command</em> key the ansible_shell list of
dictionary. Extra_args for the shell command can be provided as a part of the ansible_shell
list of dictionary or under ansible_options. Please see <a class="reference internal" href="#extra-args"><span class="std std-ref">Extra_args</span></a>
<a class="reference internal" href="#eg-12"><span class="std std-ref">Example 12</span></a></p>
<p>When building your shell commands it is important to take into consideration
that there are multiple layers the command is being passed through before
being executed. The two main things to pay attention to are
YAML syntax/escaping and Shell escaping.</p>
<p>When writing the command in the scenario descriptor file it needs to be written in
a way that both Teflo and Ansible can parse the YAML properly. From a Teflo perspective
it is when the the scenario descriptor is first loaded. From an Ansible perspective
its when we pass it the playbook we create, cbn_execute_shell.yml, through to the
ansible-playbook CLI.</p>
<p>Then there could be further escapes required to preserve the test command so it can be
interpreted by the shell properly. From a Teflo perspective that is when we
pass the test command to the ansible-playbook CLI on the local shell using the
-e “xcmd=’&lt;test_command&gt;’” parameter. From the Ansible perspective its when
the shell module executes the actual test command using the shell on the designated system.</p>
<p>Let’s go into a couple examples</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_shell</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">glusto --pytest=&#39;-v tests/test_sample.py --junitxml=/tmp/SampleTest.xml&#39;</span>
             <span class="l l-Scalar l-Scalar-Plain">--log /tmp/glusto_sample.log</span>
</pre></div>
</div>
<p>On the surface the above command will pass YAML syntax parsing but will fail when actually
executing the command on the shell. That is because the command is not preserved properly on
the shell when it comes to the <em>–pytest</em> optioned being passed in. In order to get
this to work you could escape this in one of two ways so that the <em>–pytest</em> optioned is
preserved.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_shell</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">glusto --pytest=\\\&quot;-v tests/test_sample.py --junitxml=/tmp/SampleTest.xml\\\&quot;</span>
             <span class="l l-Scalar l-Scalar-Plain">--log /tmp/glusto_sample.log</span>


<span class="nt">ansible_shell</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">glusto \\\&quot;--pytest=-v tests/test_sample.py --junitxml=/tmp/SampleTest.xml\\\&quot;</span>
             <span class="l l-Scalar l-Scalar-Plain">--log /tmp/glusto_sample.log</span>
</pre></div>
</div>
<p>Here is a more complex example</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_shell</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">if [ `echo \$PRE_GA | tr [:upper:] [:lower:]` == &#39;true&#39; ];</span>
               <span class="l l-Scalar l-Scalar-Plain">then sed -i &#39;s/pre_ga:.*/pre_ga</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true/&#39; ansible/test_playbook.yml; fi</span>
</pre></div>
</div>
<p>By default this will fail to be parsed by YAML as improper syntax. The rule of thumb is
if your unquoted YAML string has any of the following special characters :-{}[]!#|&gt;&amp;%&#64;
the best practice is to quote the string. You have the option to either use single quote
or double quotes. There are pros and cons to which quoting method to use. There are online
resources that go further into this topic.</p>
<p>Once the string is quoted, you now need to make sure the command is preserved properly
on the shell. Below are a couple of examples of how you could achieve this using either
a single quoted or double quoted YAML string</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_shell</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="s">&#39;if</span><span class="nv"> </span><span class="s">[</span><span class="nv"> </span><span class="s">\`echo</span><span class="nv"> </span><span class="s">\$PRE_GA</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">tr</span><span class="nv"> </span><span class="s">[:upper:]</span><span class="nv"> </span><span class="s">[:lower:]\`</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="se">&#39;&#39;</span><span class="s">true</span><span class="se">&#39;&#39;</span><span class="nv"> </span><span class="s">];</span>
                <span class="s">then</span><span class="nv"> </span><span class="s">sed</span><span class="nv"> </span><span class="s">-i</span><span class="nv"> </span><span class="s">\&quot;s/pre_ga:.*/pre_ga:</span><span class="nv"> </span><span class="s">true/\&quot;</span><span class="nv"> </span><span class="s">ansible/test_playbook.yml;</span><span class="nv"> </span><span class="s">fi&#39;</span>


<span class="nt">ansible_shell</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="s">&quot;if</span><span class="nv"> </span><span class="s">[</span><span class="nv"> </span><span class="s">\\`echo</span><span class="nv"> </span><span class="s">\\$PRE_GA</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">tr</span><span class="nv"> </span><span class="s">[:upper:]</span><span class="nv"> </span><span class="s">[:lower:]\\`</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">\\&#39;true\\&#39;</span><span class="nv"> </span><span class="s">];</span>
                <span class="s">then</span><span class="nv"> </span><span class="s">sed</span><span class="nv"> </span><span class="s">\\&#39;s/pre_ga:.*/pre_ga:</span><span class="nv"> </span><span class="s">true/\\&#39;</span><span class="nv"> </span><span class="s">ansible/test_playbook.yml;</span><span class="nv"> </span><span class="s">fi&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is NOT recommended to output verbose logging to standard output for long running tests as there could be
issues with teflo parsing the output</p>
</div>
</div>
<div class="section" id="using-ansible-playbook">
<h3>Using ansible_playbook<a class="headerlink" href="#using-ansible-playbook" title="Permalink to this headline">¶</a></h3>
<p>Using the ansible_playbook parameter you can provide the playbook to be run
The name of the playbook can be provided as the <em>name</em> key of the orchestrate task
OR under the ansible_playbook list of dictionary</p>
<p><a class="reference internal" href="#eg-2"><span class="std std-ref">Example2</span></a>
<a class="reference internal" href="#eg-12"><span class="std std-ref">Example12</span></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Unlike the shell or script parameter the test playbook executes locally
from where teflo is running. Which means the test playbook must be in
the workspace.</p>
</div>
<div class="admonition note" id="extra-args">
<p class="first admonition-title">Note</p>
<p class="last">Only one action type, either ansible_playbook or ansible_script or ansible_shell is supported
per orchestrate task</p>
</div>
</div>
<div class="section" id="extra-args-for-script-and-shell">
<h3>Extra_args for script and shell<a class="headerlink" href="#extra-args-for-script-and-shell" title="Permalink to this headline">¶</a></h3>
<p>Teflo supports the following parameters used by ansible script and shell modules</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameters</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>chdir</td>
</tr>
<tr class="row-odd"><td>creates</td>
</tr>
<tr class="row-even"><td>decrypt</td>
</tr>
<tr class="row-odd"><td>executable</td>
</tr>
<tr class="row-even"><td>removes</td>
</tr>
<tr class="row-odd"><td>warn</td>
</tr>
<tr class="row-even"><td>stdin</td>
</tr>
<tr class="row-odd"><td>stdin_add_newline</td>
</tr>
</tbody>
</table>
<p>Please look here for more info</p>
<p><a class="reference external" href="https://docs.ansible.com/ansible/latest/modules/script_module.html">Ansible Script Module</a>
<a class="reference external" href="https://docs.ansible.com/ansible/latest/modules/shell_module.html">Ansible Shell Module</a></p>
</div>
<div class="section" id="vault-password-file">
<h3>vault-password-file<a class="headerlink" href="#vault-password-file" title="Permalink to this headline">¶</a></h3>
<p>The vault-password-file can be passed using <strong>vault-password-file</strong> under <strong>ansible_options</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">orchestrate</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rhsm_register.yml</span>
    <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;register</span><span class="nv"> </span><span class="s">systems</span><span class="nv"> </span><span class="s">under</span><span class="nv"> </span><span class="s">test</span><span class="nv"> </span><span class="s">against</span><span class="nv"> </span><span class="s">rhsm&quot;</span>
    <span class="nt">orchestrator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible</span>
    <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">all</span>
    <span class="nt">ansible_options</span><span class="p">:</span>
      <span class="nt">vault-password-file</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;./vaultpass&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="extra-vars">
<h3>Extra_vars<a class="headerlink" href="#extra-vars" title="Permalink to this headline">¶</a></h3>
<p>Extra variables needed by ansible playbooks can be passed using <strong>extra_vars</strong> key under
the <strong>ansible_options</strong> section</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">orchestrate</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rhsm_register.yml</span>
    <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;register</span><span class="nv"> </span><span class="s">systems</span><span class="nv"> </span><span class="s">under</span><span class="nv"> </span><span class="s">test</span><span class="nv"> </span><span class="s">against</span><span class="nv"> </span><span class="s">rhsm&quot;</span>
    <span class="nt">orchestrator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible</span>
    <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">all</span>
    <span class="nt">ansible_options</span><span class="p">:</span>
      <span class="nt">extra_vars</span><span class="p">:</span>
        <span class="nt">username</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kingbob</span>
        <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minions</span>
        <span class="nt">server_hostname</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">server01.example.com</span>
        <span class="nt">auto_attach</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>Use the <strong>file</strong> key to pass a variable file to the playbook. This file needs to present in teflo’s workspace</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">orchestrate</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rhsm_register.yml</span>
    <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;register</span><span class="nv"> </span><span class="s">systems</span><span class="nv"> </span><span class="s">under</span><span class="nv"> </span><span class="s">test</span><span class="nv"> </span><span class="s">against</span><span class="nv"> </span><span class="s">rhsm&quot;</span>
    <span class="nt">orchestrator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible</span>
    <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">all</span>
    <span class="nt">ansible_options</span><span class="p">:</span>
      <span class="nt">extra_vars</span><span class="p">:</span>
        <span class="nt">file</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">variable_file.yml</span>
</pre></div>
</div>
</div>
<div class="section" id="ansible-galaxy-options">
<h3>Ansible Galaxy Options<a class="headerlink" href="#ansible-galaxy-options" title="Permalink to this headline">¶</a></h3>
<p>These are additional options provided to the ansible orchestrator regarding the ansible roles and collections</p>
<div class="section" id="retry">
<h4>Retry<a class="headerlink" href="#retry" title="Permalink to this headline">¶</a></h4>
<p>To make sure ansible roles and collections are downloaded correctly, ‘retry’ ansible galaxy option is used</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible/setup-vnc.yml</span>
  <span class="nt">description</span><span class="p">:</span> <span class="s">&quot;setup</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">vnc</span><span class="nv"> </span><span class="s">server</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">test</span><span class="nv"> </span><span class="s">clients&quot;</span>
  <span class="nt">orchestrator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">vnc</span>
  <span class="nt">ansible_galaxy_options</span><span class="p">:</span>
    <span class="nt">role_file</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">roles.yml</span>
    <span class="nt">retry</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Lets dive into a couple different examples.</p>
<div class="section" id="example-1">
<h3>Example 1<a class="headerlink" href="#example-1" title="Permalink to this headline">¶</a></h3>
<p>You have a playbook which needs to run against x number of hosts and does not
require any additional extra variables.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">rhsm_register</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;register systems under test against rhsm&quot;</span>
    <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
    <span class="n">hosts</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">host01</span>
      <span class="o">-</span> <span class="n">host02</span>
</pre></div>
</div>
</div>
<div class="section" id="example-2">
<span id="eg-2"></span><h3>Example 2<a class="headerlink" href="#example-2" title="Permalink to this headline">¶</a></h3>
<p>You have a playbook which needs to run against x number of hosts and requires
additional extra variables.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">rhsm_register</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;register systems under test against rhsm&quot;</span>
    <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
    <span class="n">hosts</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">host01</span>
      <span class="o">-</span> <span class="n">host02</span>
    <span class="n">ansible_options</span><span class="p">:</span>
      <span class="n">extra_vars</span><span class="p">:</span>
        <span class="n">username</span><span class="p">:</span> <span class="n">kingbob</span>
        <span class="n">password</span><span class="p">:</span> <span class="n">minions</span>
        <span class="n">server_hostname</span><span class="p">:</span> <span class="n">server01</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
        <span class="n">auto_attach</span><span class="p">:</span> <span class="n">true</span>
</pre></div>
</div>
</div>
<div class="section" id="example-3">
<h3>Example 3<a class="headerlink" href="#example-3" title="Permalink to this headline">¶</a></h3>
<p>You have a playbook which needs to run against x number of hosts and requires
only tasks with a tag set to prod.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">custom</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;running a custom playbook, only running tasks when tag=prod&quot;</span>
    <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
    <span class="n">hosts</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">host01</span>
    <span class="n">ansible_options</span><span class="p">:</span>
      <span class="n">tags</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">prod</span>
</pre></div>
</div>
</div>
<div class="section" id="example-4">
<h3>Example 4<a class="headerlink" href="#example-4" title="Permalink to this headline">¶</a></h3>
<p>You have a playbook which needs to run against x number of hosts and requires
only tasks with a tag set to prod and requires connection settings that conflicts with your ansible.cfg.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">custom2</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;custom playbook, w/ different connection options&quot;</span>
    <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
    <span class="n">hosts</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">host07</span>
    <span class="n">ansible_options</span><span class="p">:</span>
      <span class="n">forks</span><span class="p">:</span> <span class="mi">2</span>
      <span class="n">become</span><span class="p">:</span> <span class="kc">True</span>
      <span class="n">become_method</span><span class="p">:</span> <span class="n">sudo</span>
      <span class="n">become_user</span><span class="p">:</span> <span class="n">test_user2</span>
      <span class="n">remote_user</span><span class="p">:</span> <span class="n">test_user</span>
      <span class="n">connection</span><span class="p">:</span> <span class="n">paramiko</span>
      <span class="n">tags</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">prod</span>
</pre></div>
</div>
</div>
<div class="section" id="example-5">
<h3>Example 5<a class="headerlink" href="#example-5" title="Permalink to this headline">¶</a></h3>
<p>You have a playbook which needs to run against x number of hosts and requires
an ansible role to be downloaded.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Although the option is called <em>role_file:</em> but it relates both, roles and collections.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">rhsm_register</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;register systems under test against rhsm&quot;</span>
    <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
    <span class="n">hosts</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">host01</span>
      <span class="o">-</span> <span class="n">host02</span>
    <span class="n">ansible_galaxy_options</span><span class="p">:</span>
      <span class="n">role_file</span><span class="p">:</span> <span class="n">requirements</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<p>Content of requirements.yml as a dictionary, suitable for both roles and collections:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">roles</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">oasis-roles.rhsm</span>

<span class="nt">collections</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">geerlingguy.php_roles</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">geerlingguy.k8s</span>
</pre></div>
</div>
<p>As you can see we defined the role_file key. This defines the ansible
requirements filename. Teflo will consume that file and download all the
roles and collections defined within.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<dl class="last docutils">
<dt>We can define roles in the req file as a list or as dictionary, Teflo support both ways.</dt>
<dd>but if we chose to set roles as list then we can’t set collections in the same file.</dd>
</dl>
</div>
<p>Content of requirements.yml file as a list, only suitable for roles:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">oasis-roles.rhsm</span>
<span class="p p-Indicator">-</span> <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://gitlab.cee.redhat.com/PIT/roles/junit-install.git</span>
  <span class="nt">scm</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">git</span>
</pre></div>
</div>
<p>An alternative to using the requirements file is you can directly define them using
the roles or collections key.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">rhsm_register</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;register systems under test against rhsm&quot;</span>
    <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
    <span class="n">hosts</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">host01</span>
      <span class="o">-</span> <span class="n">host02</span>
    <span class="n">ansible_galaxy_options</span><span class="p">:</span>
      <span class="n">roles</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">oasis</span><span class="o">-</span><span class="n">roles</span><span class="o">.</span><span class="n">rhsm</span>
        <span class="o">-</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gitlab</span><span class="o">.</span><span class="n">cee</span><span class="o">.</span><span class="n">redhat</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">oasis</span><span class="o">-</span><span class="n">roles</span><span class="o">/</span><span class="n">coreos_infra</span><span class="o">.</span><span class="n">git</span><span class="p">,</span><span class="n">master</span><span class="p">,</span><span class="n">oasis_roles</span><span class="o">.</span><span class="n">coreos_infra</span>
      <span class="n">collections</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">geerlingguy</span><span class="o">.</span><span class="n">php_roles</span>
        <span class="o">-</span> <span class="n">geerlingguy</span><span class="o">.</span><span class="n">k8s</span>
</pre></div>
</div>
<p>It is possible to define both role_file and direct definitions. Teflo will install the
roles and collections first from the role_file and then the roles and collections defined using the keys. It is up to the
scenario to ensure no problems may occur if both are defined.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If your scenario directory has roles and collections already defined, you do not need to
define them. This is only if you want teflo to download roles or collections from sites
such as ansible galaxy, external web servers, etc.</p>
</div>
</div>
<div class="section" id="example-6">
<h3>Example 6<a class="headerlink" href="#example-6" title="Permalink to this headline">¶</a></h3>
<p>You have a playbook which needs to run against x number of hosts, requires
ansible roles to be downloaded and requires additional extra variables.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">rhsm_register</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;register systems under test against rhsm&quot;</span>
    <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
    <span class="n">hosts</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">host01</span>
      <span class="o">-</span> <span class="n">host02</span>
    <span class="n">ansible_options</span><span class="p">:</span>
      <span class="n">extra_vars</span><span class="p">:</span>
        <span class="n">username</span><span class="p">:</span> <span class="n">kingbob</span>
        <span class="n">password</span><span class="p">:</span> <span class="n">minions</span>
        <span class="n">server_hostname</span><span class="p">:</span> <span class="n">server01</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
        <span class="n">auto_attach</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">ansible_galaxy_options</span><span class="p">:</span>
      <span class="n">role_file</span><span class="p">:</span> <span class="n">roles</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p>Every scenario processed by teflo should define an ansible configuration
file. This provides the scenario with the flexibility to easily control
portions of ansible.</p>
<p>If you are using the ability to download roles or collections by teflo, you need to set
the <em>roles_path</em> or the <em>collections_paths</em> within your ansible.cfg. If this is not set, problems will
occur and teflo will fail. Due to being unable to locate the roles and collections within
the playbook its executing.</p>
<p>Here is an example ansible.cfg setting the roles_path and collections_paths to a relative path
within the scenario directory.</p>
<div class="last highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>defaults<span class="o">]</span>
<span class="nv">host_key_checking</span> <span class="o">=</span> False
<span class="nv">retry_files_enabled</span> <span class="o">=</span> False
<span class="nv">roles_path</span> <span class="o">=</span> ./roles
<span class="nv">collections_paths</span> <span class="o">=</span> ./collections
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-7">
<h3>Example 7<a class="headerlink" href="#example-7" title="Permalink to this headline">¶</a></h3>
<p>You have a playbook which needs to run against x number of hosts. Prior to
deleting the configured hosts. You want to run a playbook to do some post
tasks.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">rhsm_register</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;register systems under test against rhsm&quot;</span>
    <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
    <span class="n">hosts</span><span class="p">:</span> <span class="nb">all</span>
    <span class="n">ansible_options</span><span class="p">:</span>
      <span class="n">extra_vars</span><span class="p">:</span>
        <span class="n">username</span><span class="p">:</span> <span class="n">kingbob</span>
        <span class="n">password</span><span class="p">:</span> <span class="n">minions</span>
        <span class="n">server_hostname</span><span class="p">:</span> <span class="n">server01</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
        <span class="n">auto_attach</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">ansible_galaxy_options</span><span class="p">:</span>
      <span class="n">role_file</span><span class="p">:</span> <span class="n">roles</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">cleanup</span><span class="p">:</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">rhsm_unregister</span><span class="o">.</span><span class="n">yml</span>
      <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;unregister systems under tests from rhsm&quot;</span>
      <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
      <span class="n">hosts</span><span class="p">:</span> <span class="nb">all</span>
      <span class="n">ansible_galaxy_options</span><span class="p">:</span>
        <span class="n">role_file</span><span class="p">:</span> <span class="n">roles</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
</div>
<div class="section" id="example-8">
<h3>Example 8<a class="headerlink" href="#example-8" title="Permalink to this headline">¶</a></h3>
<p>The following is an example of running a script.  The following is an
example of a script running on the localhost. For localhost usage refer
to the`localhost &lt;../localhost.html&gt;`_ page.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">scripts</span><span class="o">/</span><span class="n">create_dir</span><span class="o">.</span><span class="n">sh</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">create</span> <span class="n">a</span> <span class="n">local</span> <span class="nb">dir</span>
    <span class="n">ansible_script</span><span class="p">:</span> <span class="kc">True</span>
    <span class="n">hosts</span><span class="p">:</span> <span class="n">localhost</span>
    <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
</pre></div>
</div>
</div>
<div class="section" id="example-9">
<h3>Example 9<a class="headerlink" href="#example-9" title="Permalink to this headline">¶</a></h3>
<p>The following builds on the previous example, by showing how a user
can add options to the script they are executing (In the example below,
the script is run with options as <strong>create_dir.sh -c -e 12</strong>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">scripts</span><span class="o">/</span><span class="n">create_dir</span><span class="o">.</span><span class="n">sh</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">creates</span> <span class="n">a</span> <span class="n">local</span> <span class="nb">dir</span>
    <span class="n">ansible_options</span><span class="p">:</span>
      <span class="n">extra_args</span><span class="p">:</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span><span class="n">e</span> <span class="mi">12</span>
    <span class="n">ansible_script</span><span class="p">:</span> <span class="kc">True</span>
    <span class="n">hosts</span><span class="p">:</span> <span class="n">localhost</span>
    <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
</pre></div>
</div>
</div>
<div class="section" id="example-10">
<h3>Example 10<a class="headerlink" href="#example-10" title="Permalink to this headline">¶</a></h3>
<p>Again building on the previous example, you can set more options to the
script execution.  The script is executed using the script ansible
module, so you can set options the script module has.  The example below
uses the <strong>chdir</strong> option.  You can also set other ansible options, and the
example below sets the <strong>remote_user</strong> option.</p>
<p>To see all script options see ansible’s documentation <a class="reference external" href="https://docs.ansible.com/ansible/latest/modules/script_module.html">here</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">scripts</span><span class="o">/</span><span class="n">create_dir</span><span class="o">.</span><span class="n">sh</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">creates</span> <span class="n">a</span> <span class="n">remote</span> <span class="nb">dir</span>
    <span class="n">ansible_options</span><span class="p">:</span>
      <span class="n">remote_user</span><span class="p">:</span> <span class="n">cloud</span><span class="o">-</span><span class="n">user</span>
      <span class="n">extra_args</span><span class="p">:</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span><span class="n">e</span> <span class="mi">12</span> <span class="n">chdir</span><span class="o">=/</span><span class="n">home</span>
    <span class="n">ansible_script</span><span class="p">:</span> <span class="kc">True</span>
    <span class="n">hosts</span><span class="p">:</span> <span class="n">host01</span>
    <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
</pre></div>
</div>
</div>
<div class="section" id="example-11">
<h3>Example 11<a class="headerlink" href="#example-11" title="Permalink to this headline">¶</a></h3>
<p>You have a playbook which needs to run against x number of hosts and requires
skipping tasks with a tag set to ssh_auth and requires extra variables.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">orchestrate</span><span class="p">:</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">ansible</span><span class="o">/</span><span class="n">ssh_connect</span><span class="o">.</span><span class="n">yml</span>
  <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;setup key authentication between driver and clients&quot;</span>
  <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
  <span class="n">hosts</span><span class="p">:</span> <span class="n">driver</span>
  <span class="n">ansible_options</span><span class="p">:</span>
    <span class="n">skip_tags</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">ssh_auth</span>
    <span class="n">extra_vars</span><span class="p">:</span>
      <span class="n">username</span><span class="p">:</span> <span class="n">root</span>
      <span class="n">password</span><span class="p">:</span> <span class="n">redhat</span>
  <span class="n">ansible_galaxy_options</span><span class="p">:</span>
    <span class="n">role_file</span><span class="p">:</span> <span class="n">roles</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
</div>
<div class="section" id="example-12">
<span id="eg-12"></span><h3>Example 12<a class="headerlink" href="#example-12" title="Permalink to this headline">¶</a></h3>
<p>Example to run playbooks, scripts and shell command as a part of orchestrate task</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">orchestrate_1</span>
  <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;orchestrate1&quot;</span>
  <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
  <span class="n">hosts</span><span class="p">:</span> <span class="n">localhost</span>
  <span class="n">ansible_playbook</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">ansible</span><span class="o">/</span><span class="n">list_block_devices</span><span class="o">.</span><span class="n">yml</span>

<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">orchestrate_2</span>
  <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;orchestrate2&quot;</span>
  <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
  <span class="n">hosts</span><span class="p">:</span> <span class="n">localhost</span>
  <span class="n">ansible_shell</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">chdir</span><span class="p">:</span> <span class="o">./</span><span class="n">test_sample_artifacts</span>
      <span class="n">command</span><span class="p">:</span> <span class="n">ls</span>
    <span class="o">-</span> <span class="n">chdir</span><span class="p">:</span> <span class="o">./</span><span class="n">test_sample_artifacts</span>
      <span class="n">command</span><span class="p">:</span> <span class="n">cp</span> <span class="n">a</span><span class="o">.</span><span class="n">txt</span> <span class="n">b</span><span class="o">.</span><span class="n">txt</span>

<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">orchestrate_3</span>
  <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;orchestrate3&quot;</span>
  <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
  <span class="n">hosts</span><span class="p">:</span> <span class="n">localhost</span>
  <span class="n">ansible_script</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">helloworld</span><span class="o">.</span><span class="n">py</span> <span class="n">Teflo_user</span>
    <span class="n">executable</span><span class="p">:</span> <span class="n">python</span>
</pre></div>
</div>
</div>
<div class="section" id="example-13">
<span id="id1"></span><h3>Example 13<a class="headerlink" href="#example-13" title="Permalink to this headline">¶</a></h3>
<p>Example to use ansible_script with extra arags with in the ansible_script
list of dictionary and its paramter in the name field</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">orchestrate_1</span>
  <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;orchestrate1&quot;</span>
  <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
  <span class="n">hosts</span><span class="p">:</span> <span class="n">localhost</span>
  <span class="n">ansible_script</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">helloworld</span><span class="o">.</span><span class="n">py</span> <span class="n">Teflo_user</span>
    <span class="n">executable</span><span class="p">:</span> <span class="n">python</span>
</pre></div>
</div>
<hr class="docutils" />
</div>
<div class="section" id="example-14">
<span id="id2"></span><h3>Example 14<a class="headerlink" href="#example-14" title="Permalink to this headline">¶</a></h3>
<p>Example to use ansible_script with extra arags as a part of ansible_options</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">orchestrate_1</span>
  <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;orchestrate1&quot;</span>
  <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
  <span class="n">hosts</span><span class="p">:</span> <span class="n">localhost</span>
  <span class="n">ansible_script</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">helloworld</span><span class="o">.</span><span class="n">py</span> <span class="n">Teflo_user</span>
  <span class="n">ansible_options</span><span class="p">:</span>
    <span class="n">extra_args</span><span class="p">:</span> <span class="n">executable</span><span class="o">=</span><span class="n">python</span>
</pre></div>
</div>
</div>
<div class="section" id="example-15">
<span id="id3"></span><h3>Example 15<a class="headerlink" href="#example-15" title="Permalink to this headline">¶</a></h3>
<p>Example to use ansible_script and using ansible_options: extra_args to
provide the script parameters</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">scripts</span><span class="o">/</span><span class="n">add_two_numbers</span><span class="o">.</span><span class="n">sh</span>
  <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
  <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>
  <span class="n">hosts</span><span class="p">:</span> <span class="n">controller</span>
  <span class="n">ansible_script</span><span class="p">:</span> <span class="kc">True</span>
  <span class="n">ansible_options</span><span class="p">:</span>
    <span class="n">extra_args</span><span class="p">:</span> <span class="n">X</span><span class="o">=</span><span class="mi">12</span> <span class="n">Y</span><span class="o">=</span><span class="mi">18</span>
</pre></div>
</div>
</div>
<div class="section" id="resources">
<h3>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h3>
<p>For system configuration &amp; product installs use roles from: <a class="reference external" href="https://github.com/oasis-roles">Oasis Roles</a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="execute.html" class="btn btn-neutral float-right" title="Execute" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="provision.html" class="btn btn-neutral float-left" title="Provision" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Red Hat Inc.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>