

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Scenario Descriptor &mdash; Teflo 0.1.2 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_override.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'0.1.2',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Resource Check" href="definitions/resource_check.html" />
    <link rel="prev" title="Teflo Quickstart" href="quickstart.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Teflo
          

          
          </a>

          
            
            
              <div class="version">
                0.1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install Teflo</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configure Teflo</a></li>
</ul>
<p class="caption"><span class="caption-text">Using Teflo</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">User’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html#detailed-information">Detailed Information</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Scenario Descriptor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="definitions/resource_check.html">Resource Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="definitions/credentials.html">Credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="definitions/include.html">Including Scenarios</a></li>
<li class="toctree-l3"><a class="reference internal" href="definitions/provision.html">Provision</a></li>
<li class="toctree-l3"><a class="reference internal" href="definitions/orchestrate.html">Orchestrate</a></li>
<li class="toctree-l3"><a class="reference internal" href="definitions/execute.html">Execute</a></li>
<li class="toctree-l3"><a class="reference internal" href="definitions/report.html">Report</a></li>
<li class="toctree-l3"><a class="reference internal" href="definitions/notifications.html">Notification</a></li>
<li class="toctree-l3"><a class="reference internal" href="definitions/timeout.html">Timeout settings for Teflo Tasks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="data_pass_through.html">Data Pass-through</a></li>
<li class="toctree-l2"><a class="reference internal" href="output.html">Teflo Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="best_practices.html">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="localhost.html">Using Localhost</a></li>
<li class="toctree-l2"><a class="reference internal" href="variable_data.html">Using Jinja Variable Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="resource_labels.html">Using Resource Labels</a></li>
<li class="toctree-l2"><a class="reference internal" href="faqs.html">FAQS</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Teflo Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developers/index.html">Developer’s Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">Contacts</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Teflo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">User’s Guide</a> &raquo;</li>
        
      <li>Scenario Descriptor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/users/scenario_descriptor.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="scenario-descriptor">
<h1>Scenario Descriptor<a class="headerlink" href="#scenario-descriptor" title="Permalink to this headline">¶</a></h1>
<p>This page is intended to explain the input to teflo. The goal and focus behind
teflos input is to be simple and transparent. It uses common language to
describe the entire scenario (E2E). The input is written in YAML. The term
used to reference teflo’s input is a scenario descriptor file. You will hear
this throughout teflo’s documentation.</p>
<p>Every scenario descriptor file is broken down into different sections. Below is
a table of the keys that correlate to the different sections.</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Description</th>
<th class="head">Type</th>
<th class="head">Required</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>name</td>
<td>The name of the scenario descriptor file.</td>
<td>String</td>
<td>True</td>
</tr>
<tr class="row-odd"><td>description</td>
<td>A description of the intent of the scenario.</td>
<td>String</td>
<td>False</td>
</tr>
<tr class="row-even"><td>resource_check</td>
<td>A list of external resources the scenario depends on
that Teflo can check in Semaphore before running
the scenario.</td>
<td>List</td>
<td>False</td>
</tr>
<tr class="row-odd"><td>include</td>
<td>A list of scenario descriptor files that should be included
when running the scenario.</td>
<td>List</td>
<td>False</td>
</tr>
<tr class="row-even"><td>provision</td>
<td>A list that contains blocks of Asset definitions that should be dynamically
provisioned or statically defined to be used by the rest of the scenario.</td>
<td>List</td>
<td>False</td>
</tr>
<tr class="row-odd"><td>orchestrate</td>
<td>A list that contains blocks of Action definitions that define scripts or
playbooks that should be run to configure the assets defined in the provision.</td>
<td>List</td>
<td>False</td>
</tr>
<tr class="row-even"><td>execute</td>
<td>A list that contains blocks of Execute definitions that define scripts,
commands, or playbooks that execute tests on the appropriately configured assets.</td>
<td>List</td>
<td>False</td>
</tr>
<tr class="row-odd"><td>report</td>
<td>A list that contains blocks of Report definitions that should be run
to import test artifacts collected during test execution to a desired
reporting system.</td>
<td>List</td>
<td>False</td>
</tr>
</tbody>
</table>
<p>Each section relates to a particular component within teflo. You can learn about this at
the <a class="reference external" href="../developers/architecture.html">architecture</a> page. Below are sub pages which go
into further detail explaining the different sections.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="definitions/resource_check.html">Resource Check</a></li>
<li class="toctree-l1"><a class="reference internal" href="definitions/credentials.html">Credentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="definitions/include.html">Including Scenarios</a></li>
<li class="toctree-l1"><a class="reference internal" href="definitions/provision.html">Provision</a></li>
<li class="toctree-l1"><a class="reference internal" href="definitions/orchestrate.html">Orchestrate</a></li>
<li class="toctree-l1"><a class="reference internal" href="definitions/execute.html">Execute</a></li>
<li class="toctree-l1"><a class="reference internal" href="definitions/report.html">Report</a></li>
<li class="toctree-l1"><a class="reference internal" href="definitions/notifications.html">Notification</a></li>
<li class="toctree-l1"><a class="reference internal" href="definitions/timeout.html">Timeout settings for Teflo Tasks</a></li>
</ul>
</div>
<p>When we put all of these sections together, we have a complete scenario to
provide to teflo. You can see an example of a complete scenario descriptor
below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>

<span class="c1"># template used to demonstrate the layout of a multi product (interop)</span>
<span class="c1"># scenario definition consumable by the interop framework in this case</span>
<span class="c1"># teflo.</span>

<span class="c1"># generic section</span>
<span class="c1"># defines common information about the scenario</span>

<span class="n">name</span><span class="p">:</span> <span class="n">demo</span>
<span class="n">description</span><span class="p">:</span> <span class="o">&gt;</span>
    <span class="n">Scenario</span> <span class="n">to</span> <span class="n">demonstration</span> <span class="n">the</span> <span class="n">teflo</span> <span class="n">framework</span><span class="o">.</span>

<span class="c1"># resource checking section</span>
<span class="c1"># As part of the validation that teflo performs, it can also</span>
<span class="c1"># check the status of resources that an end to end scenario</span>
<span class="c1"># relies on.  The user can set a list of services</span>
<span class="c1"># that need to be checked for status</span>
<span class="c1"># prior to the start of the teflo workflow under monitored_services.</span>
<span class="c1">#</span>
<span class="c1"># Note: these services will only be validated if you</span>
<span class="c1"># set the resource_check_endpoint key in your teflo.cfg file e.g.</span>
<span class="c1">#</span>
<span class="c1"># in teflo.cfg add:</span>
<span class="c1"># [defaults]</span>
<span class="c1"># resource_check_endpoint=https://semaphore.cloud.upshift.engineering.redhat.com/api/v1</span>
<span class="c1">#</span>
<span class="c1"># Along with services, users can run their own validation playbooks or scripts before</span>
<span class="c1"># starting the teflo workflow. If the validation here fails the workflow doe snot move ahead</span>
<span class="c1"># Playbooks and scripts use Teflo&#39;s ansible executor/runner</span>

<span class="n">resource_check</span><span class="p">:</span>
  <span class="n">monitored_services</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">ci</span><span class="o">-</span><span class="n">rhos</span>
    <span class="o">-</span> <span class="n">brew</span>
    <span class="o">-</span> <span class="n">polarion</span>
    <span class="o">-</span> <span class="n">umb</span>
    <span class="o">-</span> <span class="n">errata</span>
    <span class="o">-</span> <span class="n">rdo</span><span class="o">-</span><span class="n">cloud</span>
    <span class="o">-</span> <span class="n">covscan</span>
    <span class="o">-</span> <span class="n">rpmdiff</span>
    <span class="o">-</span> <span class="n">gerrit</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">eng</span><span class="o">.</span><span class="n">bos</span><span class="o">.</span><span class="n">redhat</span><span class="o">.</span><span class="n">com</span>
    <span class="o">-</span> <span class="n">code</span><span class="o">.</span><span class="n">engineering</span><span class="o">.</span><span class="n">redhat</span><span class="o">.</span><span class="n">com</span>
  <span class="n">playbook</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">ansible</span><span class="o">/</span><span class="n">list_block_devices</span><span class="o">.</span><span class="n">yml</span>
      <span class="n">ansible_options</span><span class="p">:</span>
        <span class="n">extra_vars</span><span class="p">:</span>
          <span class="n">X</span><span class="p">:</span> <span class="mi">18</span>
          <span class="n">Y</span><span class="p">:</span> <span class="mi">12</span>
          <span class="n">ch_dir</span><span class="p">:</span> <span class="o">./</span><span class="n">scripts</span><span class="o">/</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">ansible</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test_execute_playbook</span><span class="o">.</span><span class="n">yml</span>
      <span class="n">ansible_options</span><span class="p">:</span>
        <span class="n">extra_vars</span><span class="p">:</span>
          <span class="n">X</span><span class="p">:</span> <span class="mi">12</span>
          <span class="n">Y</span><span class="p">:</span> <span class="mi">12</span>
          <span class="n">ch_dir</span><span class="p">:</span> <span class="o">../../</span><span class="n">scripts</span><span class="o">/</span>
  <span class="n">script</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">hello_world1</span><span class="o">.</span><span class="n">py</span> <span class="n">Teflo_user</span>
        <span class="n">executable</span><span class="p">:</span> <span class="n">python</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">add_two_numbers</span><span class="o">.</span><span class="n">sh</span> <span class="n">X</span><span class="o">=</span><span class="mi">15</span> <span class="n">Y</span><span class="o">=</span><span class="mi">15</span>

<span class="c1"># include section</span>
<span class="c1"># Defines any other scenario files that need to be executed</span>
<span class="c1"># These scenario files have to be in the same workspace as the master/original scenario</span>
<span class="c1"># During running of teflo workflow tasks from the included scenarios will be run</span>
<span class="c1"># e.g if task selected is provision, the resources of master scenario will be provisioned</span>
<span class="c1"># followed by provisioning of resources defined in the included scenarios</span>

<span class="n">include</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">py3_incl_prov</span><span class="o">.</span><span class="n">yml</span>
  <span class="o">-</span> <span class="n">py3_incl_orch</span><span class="o">.</span><span class="n">yml</span>

<span class="c1"># provision section</span>
<span class="c1"># defines all systems required for the scenario</span>

<span class="n">provision</span><span class="p">:</span>
  <span class="c1"># test driver</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">testdriver</span>                            <span class="c1"># machine name used for creation</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;test driver&quot;</span>                  <span class="c1"># describes the purpose of the host</span>
    <span class="n">provider</span><span class="p">:</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">openstack</span>                           <span class="c1"># provider to create host in</span>
      <span class="n">credential</span><span class="p">:</span> <span class="n">openstack</span>                     <span class="c1"># ref above ^^: credentials.openstack</span>
      <span class="n">image</span><span class="p">:</span> <span class="n">rhel</span><span class="o">-</span><span class="mf">7.5</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">released</span>    <span class="c1"># image to boot instance based on</span>
      <span class="n">flavor</span><span class="p">:</span> <span class="n">m1</span><span class="o">.</span><span class="n">small</span>                          <span class="c1"># instance size</span>
      <span class="n">networks</span><span class="p">:</span>                                 <span class="c1"># instance internal network</span>
        <span class="o">-</span> <span class="o">&lt;</span><span class="n">internal</span><span class="o">-</span><span class="n">network</span><span class="o">&gt;</span>
      <span class="n">floating_ip_pool</span><span class="p">:</span> <span class="s2">&quot;10.8.240.0&quot;</span>            <span class="c1"># instance external network</span>
      <span class="n">keypair</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">keypair</span><span class="o">&gt;</span>                        <span class="c1"># instance ssh key pair</span>
    <span class="n">role</span><span class="p">:</span> <span class="n">testdriver</span>                            <span class="c1"># host role</span>
    <span class="n">ansible_params</span><span class="p">:</span>                             <span class="c1"># defines ansible parameters for connection</span>
      <span class="n">ansible_user</span><span class="p">:</span> <span class="n">root</span>
      <span class="n">ansible_ssh_private_key_file</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">private</span><span class="o">-</span><span class="n">key</span><span class="o">-</span><span class="n">filename</span><span class="o">&gt;</span>

  <span class="c1"># test client 1</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">testclient01</span>                          <span class="c1"># machine name used for creation</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;test client 01&quot;</span>               <span class="c1"># describes the purpose of the host</span>
    <span class="n">provider</span><span class="p">:</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">openstack</span>                           <span class="c1"># provider to create host in</span>
      <span class="n">credential</span><span class="p">:</span> <span class="n">openstack</span>                     <span class="c1"># ref above ^^: credentials.openstack</span>
      <span class="n">image</span><span class="p">:</span> <span class="n">rhel</span><span class="o">-</span><span class="mf">7.5</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">released</span>    <span class="c1"># image to boot instance based on</span>
      <span class="n">flavor</span><span class="p">:</span> <span class="n">m1</span><span class="o">.</span><span class="n">small</span>                          <span class="c1"># instance size</span>
      <span class="n">networks</span><span class="p">:</span>                                 <span class="c1"># instance internal network</span>
        <span class="o">-</span> <span class="o">&lt;</span><span class="n">internal</span><span class="o">-</span><span class="n">network</span><span class="o">&gt;</span>
      <span class="n">floating_ip_pool</span><span class="p">:</span> <span class="s2">&quot;10.8.240.0&quot;</span>            <span class="c1"># instance external network</span>
      <span class="n">keypair</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">keypair</span><span class="o">&gt;</span>                        <span class="c1"># instance ssh key pair</span>
    <span class="n">role</span><span class="p">:</span> <span class="n">testclient</span>                            <span class="c1"># host role</span>
    <span class="n">ansible_params</span><span class="p">:</span>                             <span class="c1"># defines ansible parameters for connection</span>
      <span class="n">ansible_user</span><span class="p">:</span> <span class="n">root</span>
      <span class="n">ansible_ssh_private_key_file</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">private</span><span class="o">-</span><span class="n">key</span><span class="o">-</span><span class="n">filename</span><span class="o">&gt;</span>

  <span class="c1"># test client 2, defining a static machine</span>
  <span class="c1"># this is useful if you wish to skip teflo&#39;s provisioning</span>
  <span class="c1"># this machine can be referenced in orchestrate and execute</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">testclient02</span>                          <span class="c1"># machine name used for creation</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;test client 02&quot;</span>               <span class="c1"># describes the purpose of the host</span>
    <span class="n">ip_address</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">machine_ip_address</span><span class="o">&gt;</span>
    <span class="n">role</span><span class="p">:</span> <span class="n">testclient</span>                            <span class="c1"># host role</span>
    <span class="n">ansible_params</span><span class="p">:</span>                             <span class="c1"># defines ansible parameters for connection</span>
      <span class="n">ansible_user</span><span class="p">:</span> <span class="n">root</span>
      <span class="n">ansible_ssh_private_key_file</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">private</span><span class="o">-</span><span class="n">key</span><span class="o">-</span><span class="n">filename</span><span class="o">&gt;</span>


<span class="c1"># orchestrate section</span>
<span class="c1"># defines all actions to be performed for the scenario. these actions will be</span>
<span class="c1"># executed against the systems defined in the provision section. Each action</span>
<span class="c1"># will define which system to run against.</span>
<span class="c1"># Then, three types of orchestrate actions are supported by the default orchestrator (ansible):</span>
<span class="c1"># 1. ansible_shell</span>
<span class="c1"># 2. ansible_script</span>
<span class="c1"># 3. ansible_playbook</span>
<span class="c1"># Only one type of orchestrate action can be run per action.</span>

<span class="n">orchestrate</span><span class="p">:</span>
  <span class="c1"># user defined playbook to execute</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">task_1</span>                                <span class="c1"># action name</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;performs custom config&quot;</span>       <span class="c1"># describes what is being performed on the hosts</span>
    <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>                       <span class="c1"># orchestrator module to use in this case ansible</span>
    <span class="n">hosts</span><span class="p">:</span>                                      <span class="c1"># hosts which the action is executed on</span>
      <span class="o">-</span> <span class="n">testclient01</span>                            <span class="c1"># ref above ^^: provision.testclient01</span>
      <span class="o">-</span> <span class="n">testclient02</span>                            <span class="c1"># ref above ^^: provision.testclient02</span>
    <span class="n">ansible_playbook</span><span class="p">:</span>                           <span class="c1"># using ansible playbook</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">custom</span><span class="o">.</span><span class="n">yml</span>                          <span class="c1"># name (playbook name) (full filename and path relative to the workspace)</span>
    <span class="n">ansible_options</span><span class="p">:</span>                            <span class="c1"># options used by ansible orchestrator</span>
      <span class="n">extra_vars</span><span class="p">:</span>
        <span class="n">var01</span><span class="p">:</span> <span class="n">value01</span>
    <span class="n">ansible_galaxy_options</span><span class="p">:</span>                     <span class="c1"># options used by ansible galaxy</span>
      <span class="n">role_file</span><span class="p">:</span> <span class="n">role</span><span class="o">.</span><span class="n">yml</span>

  <span class="c1"># create ssh key pair for ssh connection between driver/client(s)</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">create_ssh_keypair</span>                     <span class="c1"># action name</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;creates ssh key pair for auth&quot;</span> <span class="c1"># describes what is being performed on the hosts</span>
    <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>                        <span class="c1"># orchestrator module to use in this case ansible</span>
    <span class="n">hosts</span><span class="p">:</span>                                       <span class="c1"># hosts which the action is executed on</span>
      <span class="o">-</span> <span class="n">testdriver</span>                               <span class="c1"># ref above ^^: provision.testdriver</span>
    <span class="n">ansible_playbook</span><span class="p">:</span>                            <span class="c1"># playbook name(full filename and path relative to the workspace)</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">create_ssh_keypair</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">ansible_options</span><span class="p">:</span>                             <span class="c1"># options used by ansible orchestrator</span>
      <span class="n">extra_vars</span><span class="p">:</span>
        <span class="n">user</span><span class="p">:</span> <span class="n">root</span>

  <span class="c1"># inject driver ssh public key pair to client(s)</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">inject_pub_key</span>                        <span class="c1"># action name</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;injects ssh keys into sut&quot;</span>    <span class="c1"># describes what is being performed on the hosts</span>
    <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>                       <span class="c1"># orchestrator module to use in this case ansible</span>
    <span class="n">hosts</span><span class="p">:</span>                                      <span class="c1"># hosts which the action is executed on</span>
      <span class="o">-</span> <span class="n">testdriver</span>                              <span class="c1"># ref above ^^: provision.testdrive</span>
    <span class="n">ansible_playbook</span><span class="p">:</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">inject_pub_key</span><span class="o">.</span><span class="n">yml</span>                  <span class="c1"># playbook name(full filename and path relative to the workspace)</span>
    <span class="n">ansible_options</span><span class="p">:</span>                            <span class="c1"># options used by ansible orchestrator</span>
      <span class="n">extra_vars</span><span class="p">:</span>
        <span class="n">user</span><span class="p">:</span> <span class="n">root</span>
        <span class="n">machine</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">testclient01</span>
          <span class="o">-</span> <span class="n">testclient02</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">rhn_subscribe</span>                         <span class="c1"># action name</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;subscribe to rhsm&quot;</span>            <span class="c1"># describes what is being performed on the hosts</span>
    <span class="n">orchestrator</span><span class="p">:</span> <span class="n">ansible</span>                       <span class="c1"># orchestrator module to use in this case ansible</span>
    <span class="n">hosts</span><span class="p">:</span>                                      <span class="c1"># hosts which the action is executed on</span>
      <span class="o">-</span> <span class="nb">all</span>                                     <span class="c1"># ref above ^^ to all hosts : provision.*</span>
    <span class="n">ansible_playbook</span><span class="p">:</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">rhn_subscribe</span><span class="o">.</span><span class="n">yml</span>                   <span class="c1"># playbook name(full filename and path relative to the workspace)</span>
    <span class="n">ansible_options</span><span class="p">:</span>                            <span class="c1"># options used by ansible orchestrator</span>
      <span class="n">extra_vars</span><span class="p">:</span>
        <span class="n">rhn_hostname</span><span class="p">:</span> <span class="n">subscription</span><span class="o">.</span><span class="n">rhsm</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">redhat</span><span class="o">.</span><span class="n">com</span>
        <span class="n">rhn_user</span><span class="p">:</span> <span class="n">rhel_server_01</span>
        <span class="n">rhn_password</span><span class="p">:</span> <span class="n">password</span>
        <span class="n">auto</span><span class="p">:</span> <span class="kc">True</span>

<span class="c1"># execute section</span>
<span class="c1"># defines all the tests to be executed for the scenario</span>
<span class="c1"># Each execute task has an option to clone a git,</span>
<span class="c1"># where the tests resides if not done in orchestrate</span>
<span class="c1"># Then, three types of execution supported by the default executor (runner):</span>
<span class="c1"># 1. shell</span>
<span class="c1"># 2. script</span>
<span class="c1"># 3. playbook</span>
<span class="c1"># One must be selected</span>
<span class="c1"># Finally, each task has an optional artifacts key used for</span>
<span class="c1"># data gathering after the test execution.</span>

<span class="n">execute</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">test_suite_01</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;execute tests against test clients&quot;</span>
    <span class="n">executor</span><span class="p">:</span> <span class="n">runner</span>
    <span class="n">hosts</span><span class="p">:</span> <span class="n">driver</span>
    <span class="n">git</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">repo</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">server</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">myproject</span><span class="o">.</span><span class="n">git</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">test</span><span class="o">-</span><span class="n">ver</span><span class="o">-</span><span class="mf">0.1</span>
        <span class="n">dest</span><span class="p">:</span> <span class="o">/</span><span class="n">tmp</span>
    <span class="n">shell</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">chdir</span><span class="p">:</span> <span class="o">/</span><span class="n">tmp</span>
        <span class="n">command</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">restraint</span> <span class="o">--</span><span class="n">host</span> <span class="mi">1</span><span class="o">=</span><span class="p">{{</span><span class="n">testclient01</span><span class="p">}}:</span><span class="mi">8081</span> <span class="o">--</span><span class="n">job</span> <span class="n">foo</span><span class="o">.</span><span class="n">xml</span>
    <span class="n">artifacts</span><span class="p">:</span> <span class="n">retraint</span><span class="o">-*</span><span class="p">,</span> <span class="n">test</span><span class="o">.</span><span class="n">log</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">test_suite_02</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;execute tests against test clients&quot;</span>
    <span class="n">executor</span><span class="p">:</span> <span class="n">runner</span>
    <span class="n">hosts</span><span class="p">:</span> <span class="n">driver</span>
    <span class="n">git</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">repo</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">server</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">myproject</span><span class="o">.</span><span class="n">git</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">test</span><span class="o">-</span><span class="n">ver</span><span class="o">-</span><span class="mf">0.1</span>
        <span class="n">dest</span><span class="p">:</span> <span class="o">/</span><span class="n">tmp</span>
    <span class="n">script</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">chdir</span><span class="p">:</span> <span class="o">/</span><span class="n">tmp</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">tests</span><span class="o">.</span><span class="n">sh</span> <span class="n">arg1</span> <span class="n">arg2</span>
    <span class="n">artifacts</span><span class="p">:</span> <span class="n">retraint</span><span class="o">-*</span><span class="p">,</span> <span class="n">test</span><span class="o">.</span><span class="n">log</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">test_suite_03</span>
    <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;execute tests against test clients&quot;</span>
    <span class="n">executor</span><span class="p">:</span> <span class="n">runner</span>
    <span class="n">hosts</span><span class="p">:</span> <span class="n">driver</span>
    <span class="n">git</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">repo</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">server</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">myproject</span><span class="o">.</span><span class="n">git</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">test</span><span class="o">-</span><span class="n">ver</span><span class="o">-</span><span class="mf">0.1</span>
        <span class="n">dest</span><span class="p">:</span> <span class="o">/</span><span class="n">tmp</span>
    <span class="n">playbook</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">chdir</span><span class="p">:</span> <span class="o">/</span><span class="n">tmp</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">yml</span>
    <span class="n">artifacts</span><span class="p">:</span> <span class="n">retraint</span><span class="o">-*</span><span class="p">,</span> <span class="n">test</span><span class="o">.</span><span class="n">log</span>

<span class="c1"># report section</span>
<span class="c1"># Teflo supports importing to external tools using teflo plugins. Please refer the report section</span>
<span class="c1"># under Scenario Descriptor for more information on plugins</span>
<span class="c1"># Below example is for importing test runs xmls to Polarion</span>

<span class="n">report</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">suite1_results</span><span class="o">.</span><span class="n">xml</span>                           <span class="c1"># pattern to match the xml file to be imported</span>
      <span class="n">description</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">suite1</span> <span class="n">results</span> <span class="n">to</span> <span class="n">polarion</span>     <span class="c1"># description of the reporting task</span>
      <span class="n">executes</span><span class="p">:</span> <span class="n">test_suite_01</span>                            <span class="c1"># execute task to look for the artifacts/xml mentioned under name</span>
      <span class="n">importer</span><span class="p">:</span> <span class="n">polarion</span>                                 <span class="c1"># importer to be used</span>
      <span class="n">credential</span><span class="p">:</span> <span class="n">polarion</span><span class="o">-</span><span class="n">creds</span>                         <span class="c1"># credentials to connect to the external tool(provided under teflo.cfg)</span>
      <span class="n">project_id</span><span class="p">:</span> <span class="n">Teflo1</span>                                 <span class="c1"># Polarion project id</span>
      <span class="n">testsuite_properties</span><span class="p">:</span>                              <span class="c1"># test suite properties for Polarion</span>
        <span class="n">polarion</span><span class="o">-</span><span class="n">lookup</span><span class="o">-</span><span class="n">method</span><span class="p">:</span> <span class="n">name</span>
        <span class="n">polarion</span><span class="o">-</span><span class="n">custom</span><span class="o">-</span><span class="n">os</span><span class="p">:</span> <span class="n">RHEL</span> <span class="mi">8</span>
        <span class="n">polarion</span><span class="o">-</span><span class="n">testrun</span><span class="o">-</span><span class="nb">id</span><span class="p">:</span> <span class="n">PolId</span><span class="o">-</span><span class="mi">123</span>
        <span class="n">polarion</span><span class="o">-</span><span class="n">testrun</span><span class="o">-</span><span class="n">title</span><span class="p">:</span> <span class="n">Sample</span> <span class="n">Test</span> <span class="n">Run</span>

<span class="c1"># notification tasks</span>
<span class="c1"># Teflo supports notification using email as default. Please refer notification section under</span>
<span class="c1"># scenario descriptor to know more about notification using webhook plugins and different triggers</span>
<span class="c1"># that can be set for notification</span>
<span class="c1"># Below example is for notification using email on completion of provision task</span>

<span class="n">notifications</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">notify1</span>                                         <span class="c1"># task name</span>
    <span class="n">notifier</span><span class="p">:</span> <span class="n">email</span><span class="o">-</span><span class="n">notifier</span>                              <span class="c1"># notifier to be used</span>
    <span class="n">credential</span><span class="p">:</span> <span class="n">email</span>                                     <span class="c1"># credentials needed for notifier to be set under teflo.cfg</span>
    <span class="n">on_tasks</span><span class="p">:</span>                                             <span class="c1"># trigger for notification to be sent</span>
      <span class="o">-</span> <span class="n">provision</span>
    <span class="n">to</span><span class="p">:</span>                                                   <span class="c1"># list of email addresses to send the notification to</span>
      <span class="o">-</span> <span class="n">abc</span><span class="nd">@redhat</span><span class="o">.</span><span class="n">com</span>
      <span class="o">-</span> <span class="n">pqr</span><span class="nd">@redhat</span><span class="o">.</span><span class="n">com</span>
      <span class="o">-</span> <span class="n">xyz</span><span class="nd">@redhat</span><span class="o">.</span><span class="n">com</span>
    <span class="n">from</span><span class="p">:</span> <span class="n">team</span><span class="nd">@redhat</span><span class="o">.</span><span class="n">com</span>                                 <span class="c1"># email the notification is from</span>
    <span class="n">subject</span><span class="p">:</span> <span class="s1">&#39;Provision task completed&#39;</span>                   <span class="c1"># subject of the email</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="definitions/resource_check.html" class="btn btn-neutral float-right" title="Resource Check" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Teflo Quickstart" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Red Hat Inc.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>