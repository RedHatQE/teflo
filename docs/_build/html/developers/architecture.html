

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Architecture &mdash; Teflo 0.1.2 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_override.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'0.1.2',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Development" href="development.html" />
    <link rel="prev" title="Developer’s Guide" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Teflo
          

          
          </a>

          
            
            
              <div class="version">
                0.1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../users/install.html">Install Teflo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users/configuration.html">Configure Teflo</a></li>
</ul>
<p class="caption"><span class="caption-text">Using Teflo</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../users/index.html">User’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users/index.html#detailed-information">Detailed Information</a></li>
</ul>
<p class="caption"><span class="caption-text">Teflo Development</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#architecture-details">Architecture Details</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Architecture</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basics">Basics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#teflo-object">Teflo Object</a></li>
<li class="toctree-l4"><a class="reference internal" href="#teflo-pipeline">Teflo Pipeline</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plug-and-play">Plug And Play</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#development-information">Development Information</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">Contacts</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Teflo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Developer’s Guide</a> &raquo;</li>
        
      <li>Architecture</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developers/architecture.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="architecture">
<h1>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h1>
<p>This page is intended to explain the architecture behind teflo. We strongly
recommend that you review the <a class="reference external" href="../users/scenario_descriptor.html">scenario descriptor</a> since it will be helpful when following
this document.</p>
<div class="section" id="basics">
<h2>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h2>
<p>Lets first start with the basics. Teflo is driven by an input file
(scenario descriptor). This input file defines the E2E scenario to be
processed. Within the file, there are multiple task definitions defined. Each
task definition contains resources. These resources will be executed against
that given task.</p>
<p>Each teflo execution creates a teflo object for the E2E scenario.
The teflo object further creates resource objects for each of the
resources provided in the scenario descriptor file. These resources
have tasks associated to them to be executed.</p>
</div>
<div class="section" id="teflo-object">
<h2>Teflo Object<a class="headerlink" href="#teflo-object" title="Permalink to this headline">¶</a></h2>
<p>As we just learned from the <a class="reference external" href="architecture.html#basics">basics</a> section,
the teflo object contains resources. The core resource which makes up the
teflo object is a scenario resource. A scenario resource consists of multiple
objects of ‘resources’ which derive tasks for the scenario to be processed.
Each resource has a list of associated tasks to it. When teflo executes these
tasks the resources associated to that task are used.</p>
<p>Lets see a diagram with the available resources for a teflo object. The teflo
object is made up of scenario resource and the scenario resource comprises of
other resources(asset, action, execute, report, notification).</p>
<img alt="../_images/teflo_scenario_resource.png" src="../_images/teflo_scenario_resource.png" />
<p>The diagram above shows the resources that make up a scenario resource. The table
below describes each resource in more detail.</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr class="row-odd"><th class="head">Resource</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Scenario</td>
<td>The core resource which makes up the teflo compound. The scenario
resource holds the other resources(asset, action, execute and report)</td>
</tr>
<tr class="row-odd"><td>Asset</td>
<td>The asset resources define the system resources for the scenario.
These can be anything from hosts, virtual networks, storage,
security keys, etc.</td>
</tr>
<tr class="row-even"><td>Action</td>
<td>The action resources define the actions to be performed against
the defined hosts for the scenario. These actions consist of:
system configuration, product installation, product configuration,
framework installation and framework configuration. In summary this
resource provides the scenario with the ability to perform any
remote actions against the hosts defined.</td>
</tr>
<tr class="row-odd"><td>Execute</td>
<td>The execute resources define the tests to be executed against the
defined host resources.</td>
</tr>
<tr class="row-even"><td>Report</td>
<td>The report resources defines which reporting and analysis system to
import test artifacts generated during the execution phase.</td>
</tr>
<tr class="row-odd"><td>Notification</td>
<td>The notification resources defines which tool to send the notification
to based on the triggers</td>
</tr>
</tbody>
</table>
<p>Now that we have knowledge about how a teflo object is constructed. Which
includes a number of resources. Lets dive deeper into the resources. What do
we mean by this? Every resource has a number of tasks that it can correspond
to.</p>
<img alt="../_images/teflo_scenario_resource_task.png" src="../_images/teflo_scenario_resource_task.png" />
<p>The diagram above shows the teflo object with resources defined. Each of
those resources then have a list of tasks associated to it. This means that
when teflo runs a scenario, for each task to be processed it will run the
given resources associated to that given task.</p>
<p>e.g. The scenario resource has validate task. This means that when teflo runs
the validate task it will process the scenario resource.</p>
<p>e.g. The asset resource has a validate, provision and clean up task. This means
that when teflo runs the validate task it will process that asset resource.
When it goes to the provision task, it will process that asset resource and
the same for clean up task.</p>
<p>e.g. The action resource has a validate and orchestrate task. This means that
when teflo runs the validate task it will process that action resource. When
it goes to the orchestrate task, it will process that action resource.</p>
<p>This same logic goes for the execute and report resources.</p>
</div>
<div class="section" id="teflo-pipeline">
<h2>Teflo Pipeline<a class="headerlink" href="#teflo-pipeline" title="Permalink to this headline">¶</a></h2>
<p>In the previous section about <a class="reference external" href="architecture.html#teflo-object">teflo object</a>
we learned about how a teflo object is constructed with resources and tasks.
Every resource could have different tasks. Those tasks are executed in a
certain order which the user can provide.</p>
<p>Lets see a diagram showing the default tasks that will get executed
when running teflo.</p>
<img alt="../_images/teflo_pipeline.png" src="../_images/teflo_pipeline.png" />
<p>The above diagram shows the ordered list from top to bottom of the tasks
teflo will execute.</p>
<p>If no resources are associated to a given task, teflo would skip executing
the task. This provides the user with the ability to control the flow of
their scenario.</p>
</div>
<div class="section" id="plug-and-play">
<h2>Plug And Play<a class="headerlink" href="#plug-and-play" title="Permalink to this headline">¶</a></h2>
<p>Teflo was developed with the OO programming model which allows it to be
easily extended. This means teflo is very flexible at being able to
interface with various applications. Teflo supports a plugin model where
it can interface with different plugins created for teflo. Teflo has interfaces
for provisioners, orchestartors, executors, importers and notifiers. These interfaces
allow differnt plugins to work with teflo.</p>
<p>The best way to explain this is to go through a couple examples.
First we will look at how this relates to asset resources and the provision task.</p>
<p>Every asset resource defined within a teflo object has an associated provisioner
to it. This allows the user to select different tools to handle the provision task request.
Teflo provides an asset_provisioner interface which can talk to differnt provisioners, e.g.
bkr_client_plugin, os_libcloud_plugin, etc.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>teflo/provisioners
├── asset_provisioner.py
├── ext
│   ├── bkr_client_plugin
│   │   ├── beaker_client_plugin.py
│   │   ├── __init__.py
│   │   └── schema.yml
│   ├── __init__.py
│   └── os_libcloud_plugin
│       ├── __init__.py
│       ├── openstack_libcloud_plugin.py
│       └── schema.yml
├── __init__.py
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">demo</span>
<span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">demo</span>

<span class="nt">provision</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ccit_ci_test_client_a</span>
    <span class="nt">groups</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">client, test_driver</span>
    <span class="nt">provisioner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">openstack_libcloud</span>
    <span class="nt">credential</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">openstack</span>
    <span class="nt">key_pair</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ccit_key</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rhel-7.4-secommonrver-x86_64-released</span>
    <span class="nt">flavor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">m1.small</span>
    <span class="nt">network</span><span class="p">:</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">private_network</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">provider_net_cci_8</span>
    <span class="nt">ansible_params</span><span class="p">:</span>
      <span class="nt">ansible_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cloud-user</span>
      <span class="nt">ansible_ssh_private_key_file</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">keys/ccit_key</span>
</pre></div>
</div>
<p>The above code snippets demonstrate how from the asset resource definition
defined within the scenario descriptor file. It tells teflo that it would like
it to use the openstack_libcloud provisioner. With this flexibility users could
provide their own module to provision and define this as the provisioner for
their given asset resource.</p>
<p>Teflo uses bkr_client_plugin(using beaker client) and os_libcloud_plugin (using openstack libcloud) as its native
provisioner plugins. The implementation for users to plug in their own provisioner can be possible by
creating a separate provisoner plugin. We currently have  external provisioner plugins for linchpin
and openstack-client</p>
<p>Here is an example based on a custom provisioner module:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>teflo/provisioners
├── beaker.py
├── ext
│   └── __init__.py
├── __init__.py
├── openshift.py
├── openstack.py
└── provisioner_xyz.py
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">demo</span>
<span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">demo</span>

<span class="nt">provision</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">machine1</span>
      <span class="nt">provisioner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">provisioner_xyz</span>        <span class="c1"># provisioner name</span>
      <span class="nt">provider</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">openstack</span>
        <span class="nt">credential</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">openstack-creds</span>
        <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">image1</span>
        <span class="nt">flavor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">flavor</span>
        <span class="nt">networks</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">network</span>
        <span class="nt">floating_ip_pool</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.0.0.0</span>
        <span class="nt">keypair</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">keypair</span>
      <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">role</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please visit the CONTRIBUTE.rst to understand more about how to create a customized plugin for Teflo</p>
</div>
<p>Plugin model also applies to the other resources within the teflo object. Lets look
at the action resource. Teflo provides a orchestrator interface
called action_orchestrator which will interface with different orchestrator plugins.
This resources main purpose is to perform configuration actions. To do configuration
there are a lot of tools that currently exists to perform these actions.
By default teflo supports the ansible orchestrator plugin out of the box.
It can easily be plugged in to use a different orchestrator.</p>
<p>Here is an example with an action resource using the default ansible
orchestrator by teflo.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>teflo/orchestrators/
├── _ansible.py
├── _chef.py
├── ext
│   └── __init__.py
├── __init__.py
└── _puppet.py
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">demo</span>
<span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">demo</span>

<span class="nt">provision</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ccit_ci_test_client_a</span>
    <span class="nt">groups</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">client, test_driver</span>
    <span class="nt">provisioner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">openstack_libcloud</span>
    <span class="nt">credential</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">openstack</span>
    <span class="nt">key_pair</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ccit_key</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rhel-7.4-secommonrver-x86_64-released</span>
    <span class="nt">flavor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">m1.small</span>
    <span class="nt">network</span><span class="p">:</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">private_network</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">provider_net_cci_8</span>
    <span class="nt">ansible_params</span><span class="p">:</span>
      <span class="nt">ansible_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cloud-user</span>
      <span class="nt">ansible_ssh_private_key_file</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">keys/ccit_key</span>

<span class="nt">orchestrate</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rhn_subscribe</span>
      <span class="nt">orchestrator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible</span>         <span class="c1"># orchestrator name</span>
      <span class="nt">hosts</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">machine1</span>
      <span class="nt">vars</span><span class="p">:</span>
        <span class="nt">rhn_hostname</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;hostname&gt;</span>
        <span class="nt">rhn_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;user&gt;</span>
        <span class="nt">rhn_password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;password&gt;</span>
</pre></div>
</div>
<p>It can easily be extended to work with other various orchestrators.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Hopefully after reading this document you were able to have a better
understanding on how teflo was designed. To gain an even deeper understanding
on how it works. We highly recommend following the <a class="reference external" href="development.html">development</a>
document to step through the code.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="development.html" class="btn btn-neutral float-right" title="Development" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Developer’s Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Red Hat Inc.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>